<!DOCTYPE html>
<html class="writer-html5" lang="ru,en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. AutoInstall Cut Discr &mdash; BilSrvStation_Server_PC 1.0.2a documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Полное описание конфигурации сервера" href="full_discr.html" />
    <link rel="prev" title="3. Preseed Cut Discr" href="cut_discr_preseed.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> BilSrvStation_Server_PC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Содержание:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sourcelink.html">1. Навигация</a></li>
<li class="toctree-l1"><a class="reference internal" href="cut_discr_pc.html">2. ISO InstallDeb Cut Discr</a></li>
<li class="toctree-l1"><a class="reference internal" href="cut_discr_preseed.html">3. Preseed Cut Discr</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. AutoInstall Cut Discr</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#auto-postinstall">4.1. 01      AUTO POSTINSTALL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pre-install-emv-and-settings">4.1.1. 01.01   PRE-INSTALL EMV AND SETTINGS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-root-privilege">4.1.2. 01.02   CHECK ROOT PRIVILEGE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#settings-etc-network-interfaces-interface-sh">4.1.3. 01.03   SETTINGS /ETC/NETWORK -&gt; INTERFACES [interface_sh]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#settings-network-interfaces">4.1.3.1. 01.03.01        SETTINGS NETWORK/INTERFACES</a></li>
<li class="toctree-l4"><a class="reference internal" href="#search-interfaces">4.1.3.2. 01.03.02        SEARCH INTERFACES</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restart-service">4.1.3.3. 01.03.02        restart service</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#update-distribution">4.1.4. 01.04           Update distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-drivers">4.1.5. 01.05           Install drivers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-selinux-utils-acl">4.1.5.1. 01.05.01        Install SElinux utils &amp; acl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reboot">4.1.5.2. 01.05.02        Reboot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#install-git-nanorc-step-three">4.1.6. 01.06           Install git &amp;&amp; nanorc [step_three]</a></li>
<li class="toctree-l3"><a class="reference internal" href="#copy-dir">4.1.7. 01.07           Copy dir</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-utils-step-five">4.1.8. 01.08           Install utils [step_five]</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-driver-opt-and-acc-step-six">4.1.9. 01.09           Install driver opt and acc [step_six]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-disk-opt">4.1.9.1. 01.09.01        create disk /opt/</a></li>
<li class="toctree-l4"><a class="reference internal" href="#search-dev-s">4.1.9.2. 01.09.02        search /dev/s**</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mount-dev-s">4.1.9.3. 01.09.03        mount /dev/s**</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#create-users-and-groups">4.1.10. 01.10           Create users and groups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">4.1.10.1. 01.10.01                Create users and groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-ssh-ssl">4.1.10.2. 01.10.02                Create ssh_ssl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-ssh-settings">4.1.10.3. 01.10.03        Install ssh settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-users-ssh">4.1.10.4. 01.10.04        Create users ssh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-samba">4.1.10.5. 01.10.05        Create SAMBA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-and-settings-firewall">4.1.10.6. 01.10.06        Install and settings firewall</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-other-soft">4.1.10.7. 01.10.07        Install other soft</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extended-nano">4.1.10.8. 01.10.08        Extended nano</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cp-ers">4.1.10.9. 01.10.09        cp ers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-vsftp">4.1.10.10. 01.10.10        Install vsftp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#settings-permissive-selinux">4.1.11. 01.11   Settings permissive SELinux</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="full_discr.html">5. Полное описание конфигурации сервера</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">6. Структура</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_doc.html">7. Построение этой документации</a></li>
<li class="toctree-l1"><a class="reference internal" href="note.html">8. Заметки</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BilSrvStation_Server_PC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">4. </span>AutoInstall Cut Discr</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cut_discr_pii2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="autoinstall-cut-discr">
<h1><span class="section-number">4. </span>AutoInstall Cut Discr<a class="headerlink" href="#autoinstall-cut-discr" title="Permalink to this headline"></a></h1>
<div class="line-block">
<div class="line">Published by <a href="#id6"><span class="problematic" id="id7">|author|</span></a></div>
<div class="line">Date: <em>|date|</em> Time <em>|time|</em></div>
<div class="line-block">
<div class="line">Type script: <em>bash</em></div>
<div class="line">!/bin/bash
-xv
set -x
 <a class="reference external" href="https://wiki.debian.org/Microcode">https://wiki.debian.org/Microcode</a></div>
<div class="line-block">
<div class="line">uncomment      639!!!!
if [[ -z $STATE ]]; then
        exit 3;
fi
 user add
 echo &quot;<strong>****</strong>&quot; | mkpasswd -s -H MD5
 sudo usermod -p $(echo &quot;&quot; | mkpasswd -s -H MD5) test1
 sudo usermod -p $S test1
 su -p test1</div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="auto-postinstall">
<h2><span class="section-number">4.1. </span>01      AUTO POSTINSTALL<a class="headerlink" href="#auto-postinstall" title="Permalink to this headline"></a></h2>
<blockquote>
<div><div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>do postinstall copy wufu &amp; wpa_supplicant.conf + SAMBA</p>
</div>
</div></blockquote>
<div class="section" id="pre-install-emv-and-settings">
<h3><span class="section-number">4.1.1. </span>01.01   PRE-INSTALL EMV AND SETTINGS<a class="headerlink" href="#pre-install-emv-and-settings" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>d-i preseed/late_command string mkdir -p /target/install/; cp -R /install/* /target/install/; cp -Rf /install/lib/ /target/lib/;</p>
<p>cd /install/
tar -xvf wpa_supplicant-0.7.3.tar.gz
cd ./wpa_supplicant-0.7.3/
./configure
./install</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">include this boilerplate</div>
</div>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><dl class="simple">
<dt><a class="reference external" href="https://stackoverflow.com/questions/9639103/is-there-a-goto-statement-in-bash">https://stackoverflow.com/questions/9639103/is-there-a-goto-statement-in-bash</a></dt><dd><p>GOTO for bash, based upon <a class="reference external" href="https://stackoverflow.com/a/31269848/5353461">https://stackoverflow.com/a/31269848/5353461</a></p>
</dd>
</dl>
</div></blockquote>
<p>rm /install/pii2.sh /etc/init.d/</p>
</div></blockquote>
<p>update-rc.d -f pii2.sh remove</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">function</span> jumpto
<span class="linenos"> 2</span><span class="o">{</span>
<span class="linenos"> 3</span><span class="nv">label</span><span class="o">=</span><span class="nv">$1</span>
<span class="linenos"> 4</span><span class="nv">cmd</span><span class="o">=</span><span class="k">$(</span>sed -n <span class="s2">&quot;/</span><span class="nv">$label</span><span class="s2">:/{:a;n;p;ba};&quot;</span> <span class="nv">$0</span> <span class="p">|</span> grep -v <span class="s1">&#39;:$&#39;</span><span class="k">)</span>
<span class="linenos"> 5</span><span class="nb">eval</span> <span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span>
<span class="linenos"> 6</span><span class="nb">exit</span>
<span class="linenos"> 7</span><span class="o">}</span>
<span class="linenos"> 8</span><span class="k">function</span> reinterfaces
<span class="linenos"> 9</span><span class="o">{</span>
<span class="linenos">10</span><span class="nb">cd</span> /etc/network/
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p>if [[ -n $( egrep -n '^[a-z] || ^       ' interfaces) &amp;&amp; TMPS==&quot;0&quot; ]]; then</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nv">BUF</span><span class="o">=</span><span class="s2">&quot;# This file describes the network interfaces available on your system\n</span>
<span class="linenos"> 2</span><span class="s2">        # and how to activate them. For more information, see interfaces(5).\n</span>
<span class="linenos"> 3</span><span class="s2">        \n</span>
<span class="linenos"> 4</span><span class="s2">        source /etc/network/interfaces.d/*\n</span>
<span class="linenos"> 5</span><span class="s2">        \n</span>
<span class="linenos"> 6</span><span class="s2">        # The loopback network interface\n</span>
<span class="linenos"> 7</span><span class="s2">        auto lo\n</span>
<span class="linenos"> 8</span><span class="s2">        iface lo inet loopback\n</span>
<span class="linenos"> 9</span><span class="s2">        \n</span>
<span class="linenos">10</span><span class="s2">        # The Primary\n</span>
<span class="linenos">11</span><span class="s2">        allow-hotplug en\n</span>
<span class="linenos">12</span><span class="s2">        iface en inet dhcp\n&quot;</span><span class="p">;</span>
<span class="linenos">13</span>rm interfaces
<span class="linenos">14</span>touch interfaces
<span class="linenos">15</span><span class="nb">echo</span> -e <span class="nv">$BUF</span> &gt; interfaces<span class="p">;</span>
<span class="linenos">16</span><span class="o">}</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="nv">start</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="s2">&quot;start&quot;</span><span class="si">}</span>
<span class="linenos">19</span><span class="nv">interface_sh</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="s2">&quot;interface_sh&quot;</span><span class="si">}</span>
<span class="linenos">20</span><span class="nv">step_one</span><span class="o">=</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="s2">&quot;step_one&quot;</span><span class="si">}</span>
<span class="linenos">21</span><span class="nv">step_two</span><span class="o">=</span><span class="si">${</span><span class="nv">4</span><span class="k">:-</span><span class="s2">&quot;step_two&quot;</span><span class="si">}</span>
<span class="linenos">22</span><span class="nv">step_three</span><span class="o">=</span><span class="si">${</span><span class="nv">5</span><span class="k">:-</span><span class="s2">&quot;step_three&quot;</span><span class="si">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">+ install wpa_supplicant-0.7.3.tar.gz</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">export</span> <span class="nv">LC_ALL</span><span class="o">=</span>ru_RU.UTF-8
<span class="linenos"> 2</span><span class="nv">FILES</span><span class="o">=</span><span class="s2">&quot;steps.txt&quot;</span>
<span class="linenos"> 3</span><span class="nv">BUF</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="nv">COUNT</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>
<span class="linenos"> 6</span><span class="nv">DEB_VER</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="nv">NET_EN</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="nv">NET_WI</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="nv">STATE</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">;</span>
<span class="linenos">10</span><span class="nv">PORT_SSH</span><span class="o">=</span><span class="s2">&quot;4103&quot;</span>
<span class="linenos">11</span><span class="nv">NET_ARR</span><span class="o">=()</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="check-root-privilege">
<h3><span class="section-number">4.1.2. </span>01.02   CHECK ROOT PRIVILEGE<a class="headerlink" href="#check-root-privilege" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$EUID</span> -ne <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 2</span>        <span class="k">if</span> <span class="o">[[</span> <span class="si">${</span><span class="nv">LANG</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">5</span><span class="si">}</span> -eq <span class="s1">&#39;ru_RU&#39;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 3</span>                <span class="nb">echo</span> <span class="s2">&quot;Ошибка скрипта перезапустите скрипт на root&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="linenos"> 4</span>        <span class="k">else</span>
<span class="linenos"> 5</span>                <span class="nb">echo</span> <span class="s2">&quot;This script must be run as root&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="linenos"> 6</span>        <span class="k">fi</span>
<span class="linenos"> 7</span>        <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="k">fi</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="k">if</span> <span class="o">[[</span> ! -f <span class="s2">&quot;</span><span class="nv">$FILES</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">11</span>        touch steps.txt
<span class="linenos">12</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><a class="reference external" href="https://askubuntu.com/questions/1705/how-can-i-create-a-select-menu-in-a-shell-script">https://askubuntu.com/questions/1705/how-can-i-create-a-select-menu-in-a-shell-script</a>
options=(&quot;Option 1&quot; &quot;Option 2&quot; &quot;Option 3&quot; &quot;Quit&quot;)
select opt in &quot;${options[&#64;]}&quot;</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">select</span> opt in Auto PoluAuto Hands Exit<span class="p">;</span> <span class="k">do</span>
<span class="linenos"> 2</span><span class="k">case</span> <span class="nv">$opt</span> in
<span class="linenos"> 3</span>Auto<span class="o">)</span>
<span class="linenos"> 4</span>                <span class="nb">echo</span> -n <span class="s2">&quot;Сейчас будет произведена автоматическая найстройка &quot;</span><span class="p">;</span>
<span class="linenos"> 5</span>                sleep <span class="m">3</span><span class="p">;</span>
<span class="linenos"> 6</span>                jumpto start
<span class="linenos"> 7</span><span class="p">;;</span>
<span class="linenos"> 8</span>        Polstart<span class="o">)</span>
<span class="linenos"> 9</span>                <span class="nb">echo</span> -n <span class="s2">&quot;В разработке...&quot;</span><span class="p">;</span>
<span class="linenos">10</span><span class="p">;;</span>
<span class="linenos">11</span>Hands<span class="o">)</span>
<span class="linenos">12</span>                <span class="nb">echo</span> -n <span class="s2">&quot;В разработке...&quot;</span><span class="p">;</span>
<span class="linenos">13</span><span class="p">;;</span>
<span class="linenos">14</span>Exit<span class="o">)</span>
<span class="linenos">15</span><span class="nb">exit</span> <span class="m">1</span><span class="p">;</span>
<span class="linenos">16</span><span class="p">;;</span>
<span class="linenos">17</span>*<span class="o">)</span>
<span class="linenos">18</span><span class="nb">echo</span> <span class="s2">&quot;Недопустимая опция </span><span class="nv">$REPLY</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="linenos">19</span><span class="p">;;</span>
<span class="linenos">20</span><span class="k">esac</span>
<span class="linenos">21</span><span class="k">done</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>jumpto <span class="nv">$start</span>
<span class="linenos">2</span>
<span class="linenos">3</span>start:
</pre></div>
</div>
<div class="line-block">
<div class="line">  Проверка отдельных переменных окружения.
  Если переменная, к примеру $USER, не установлена,
+ то выводится сообщение об ошибке.</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>: <span class="si">${</span><span class="nv">HOSTNAME</span><span class="p">?</span><span class="si">}</span> <span class="si">${</span><span class="nv">USER</span><span class="p">?</span><span class="si">}</span> <span class="si">${</span><span class="nv">HOME</span><span class="p">?</span><span class="si">}</span> <span class="si">${</span><span class="nv">MAIL</span><span class="p">?</span><span class="si">}</span>
<span class="linenos"> 2</span><span class="nb">echo</span>
<span class="linenos"> 3</span><span class="nb">echo</span> <span class="s2">&quot;Имя машины: </span><span class="nv">$HOSTNAME</span><span class="s2">.&quot;</span>
<span class="linenos"> 4</span><span class="nb">echo</span> <span class="s2">&quot;Ваше имя: </span><span class="nv">$USER</span><span class="s2">.&quot;</span>
<span class="linenos"> 5</span><span class="nb">echo</span> <span class="s2">&quot;Ваш домашний каталог: </span><span class="nv">$HOME</span><span class="s2">.&quot;</span>
<span class="linenos"> 6</span><span class="nb">echo</span> <span class="s2">&quot;Ваш почтовый ящик: </span><span class="nv">$MAIL</span><span class="s2">.&quot;</span>
<span class="linenos"> 7</span><span class="nb">echo</span>
<span class="linenos"> 8</span><span class="nb">echo</span> <span class="s2">&quot;Если перед Вами появилось это сообщение,&quot;</span>
<span class="linenos"> 9</span><span class="nb">echo</span> <span class="s2">&quot;то это значит, что все критические переменные окружения установлены.&quot;</span>
<span class="linenos">10</span><span class="nb">echo</span>
<span class="linenos">11</span><span class="nb">echo</span> <span class="s2">&quot;Сейчас будет установлена postinstall настройка&quot;</span>
<span class="linenos">12</span><span class="nb">echo</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="nb">cd</span> /etc/apt/
<span class="linenos">15</span>cp sources.list sources.tmp
</pre></div>
</div>
<div class="line-block">
<div class="line"> &amp;VERSION_DEBIAN -e mojno off
lsb_release -d | sed -n -e 's/.*(([^)]+))/1/p'
 egrep '^[a-z]' sources.list
 sed -i 's/     deb-src http/deb-src http/g' sources.list
 sed -i 's/     deb http/deb http/g' sources.list
        algoritm:
        a.0 search deb, deb-src
???     bash buffer
lsb_release -d | sed -n 's/.*([^)])//p'
        if then yes ???
        next
        else
        poist   deb,    deb-src naub,security, updates
        if yes ???, to ubrat
        else
        version + add deb-src, deb <a class="reference external" href="http://">http://</a> ... + non-free
        a.1 search 'contrib /<a href="#id1"><span class="problematic" id="id2">|</span></a>non-free' &gt;&gt; test
        a.2 if test = 0 ? then
        ??? nado grep posi, a potom replace with check codename:
        lsb_version -da
        a.3 else ok</div>
</div>
</div>
<div class="section" id="settings-etc-network-interfaces-interface-sh">
<h3><span class="section-number">4.1.3. </span>01.03   SETTINGS /ETC/NETWORK -&gt; INTERFACES [interface_sh]<a class="headerlink" href="#settings-etc-network-interfaces-interface-sh" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">;</span>
<span class="linenos">2</span>interface_sh:
<span class="linenos">3</span>
<span class="linenos">4</span><span class="nb">cd</span> /install/
<span class="linenos">5</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(1_settings_interface_with_wifi\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="settings-network-interfaces">
<h4><span class="section-number">4.1.3.1. </span>01.03.01        SETTINGS NETWORK/INTERFACES<a class="headerlink" href="#settings-network-interfaces" title="Permalink to this headline"></a></h4>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> /etc/network/
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="search-interfaces">
<h4><span class="section-number">4.1.3.2. </span>01.03.02        SEARCH INTERFACES<a class="headerlink" href="#search-interfaces" title="Permalink to this headline"></a></h4>
<blockquote>
<div><p>2:      number</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> ! -f /etc/network/interfaces <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>        touch interfaces
<span class="linenos">3</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>cp interfaces interfaces.back
</pre></div>
</div>
<div class="line-block">
<div class="line">t.k while 1 step s.b. str !0</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nv">COUNT</span><span class="o">=</span><span class="m">1</span><span class="p">;</span>
<span class="linenos"> 2</span><span class="nv">NET_EN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">while</span> <span class="o">[[</span> -n <span class="k">$(</span> ip addr <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*</span><span class="nv">$COUNT</span><span class="s2">\:\s\(.*\)\:\s&lt;.*/\1/p&quot;</span><span class="k">)</span> <span class="o">]]</span>
<span class="linenos"> 5</span><span class="k">do</span>
<span class="linenos"> 6</span>NET_ARR<span class="o">[</span>COUNT<span class="o">]=</span><span class="k">$(</span> ip addr <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*</span><span class="nv">$COUNT</span><span class="s2">\:\s\(.*\)\:\s&lt;.*/\1/p&quot;</span><span class="k">)</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="nb">echo</span> Counter: <span class="nv">$COUNT</span> <span class="nv">$NET_EN</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="o">((</span>COUNT++<span class="o">))</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="k">done</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nv">COUNT</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">search index arr for WIFI[COUNT] and NETEN[COUNT]</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">for</span> COUNT in <span class="si">${</span><span class="nv">NET_ARR</span><span class="p">[@]</span><span class="si">}</span>
<span class="linenos"> 2</span><span class="k">do</span>
<span class="linenos"> 3</span>        <span class="k">if</span> <span class="o">[[</span> -n <span class="k">$(</span><span class="nb">echo</span> <span class="nv">$NET_ARR</span><span class="o">[</span><span class="nv">$COUNT</span><span class="o">]</span> <span class="p">|</span> sed -n -e <span class="s1">&#39;s/en\(.*\).*/\1/p&#39;</span><span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 4</span>                <span class="nv">NET_EN</span><span class="o">=</span><span class="nv">$COUNT</span><span class="p">;</span>
<span class="linenos"> 5</span>        <span class="k">fi</span>
<span class="linenos"> 6</span>        <span class="k">if</span> <span class="o">[[</span> -n <span class="k">$(</span><span class="nb">echo</span> <span class="nv">$NET_ARR</span><span class="o">[</span><span class="nv">$COUNT</span><span class="o">]</span> <span class="p">|</span> sed -n -e <span class="s1">&#39;s/wl\(.*\).*/\1/p&#39;</span><span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 7</span>                <span class="nv">NET_WI</span><span class="o">=</span><span class="nv">$COUNT</span><span class="p">;</span>
<span class="linenos"> 8</span>        <span class="k">fi</span>
<span class="linenos"> 9</span><span class="k">done</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nv">COUNT</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="k">if</span> <span class="o">[[</span> -n <span class="nv">$NET_EN</span> <span class="o">&amp;&amp;</span> -n <span class="nv">$NET_WI</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">14</span>        <span class="nv">STATE</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">;</span>
<span class="linenos">15</span><span class="k">elif</span> <span class="o">[[</span> -n <span class="nv">$NET_EN</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">16</span>        <span class="nv">STATE</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">17</span><span class="k">else</span>
<span class="linenos">18</span>        <span class="nb">echo</span> <span class="s2">&quot;Error: not search lan interfaces&quot;</span><span class="p">;</span>
<span class="linenos">19</span>        sleep <span class="m">1</span><span class="p">;</span>
<span class="linenos">20</span>        <span class="nb">exit</span> <span class="m">2</span><span class="p">;</span>
<span class="linenos">21</span><span class="k">fi</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">state =&gt; &quot;1&quot; add interfaces only en_*!!!
state =&gt; &quot;0&quot; all ok
interfaces.back - zamenit bez .back</div>
</div>
<blockquote>
<div><p>proverka interfaces</p>
<blockquote>
<div><p>Jump to label interface_sh</p>
</div></blockquote>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span> egrep -n <span class="s1">&#39;^[a-z] || ^#&#39;</span> interfaces<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$TMPS</span> -eq <span class="s2">&quot;0&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>reinterfaces
<span class="linenos">3</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"> cat interfaces.back
 analys set en wifi to two branch
 create interfaces.tmp c orig
 empty? yes - add svoi, else search 'source' 'allow' 'iface' +append_wpa
 search source and return number line $begin
BEGIN=&quot;0&quot;
END=&quot;0&quot;;
                mojet nay4itca kak udalit ostalnye stroki?
 <a class="reference external" href="https://www.baeldung.com/linux/bash-count-lines-in-file">https://www.baeldung.com/linux/bash-count-lines-in-file</a>
 sed -r -e '/[a-z]/+{1,}*/=' &lt; interfaces.back
 sed -r -e '/.*/+{1,}/ { =;  q; }' &lt; interfaces.back
 echo -e &quot;abcnrtan123456789&quot; | sed -r -e '/.*[0-9]/{1,/}/'
 sed -r -e '/[a-z]/+{1,}*/{=;q;}' interfaces.back</div>
</div>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>-1</p>
</div></blockquote>
<p><a class="reference external" href="https://www.gnu.org/software/sed/manual/html_node/Regular-Expressions.html">https://www.gnu.org/software/sed/manual/html_node/Regular-Expressions.html</a>
str /sources/</p>
</div></blockquote>
<p>COUNT=$(($( sed -r -e '/[a-z]/+{1,}*/{=;q;}' interfaces.back | sed -n '$=')-1));
if [[ $(($( sed -r -e '/[a-z]/+{1,}*/{=;q;}' interfaces | sed -n '$=')-1)) == &quot;0&quot; ]]; then</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">if [[ $(sed -n -e &quot;$=;&quot; interfaces) == &quot;0&quot; ]]; then
                TMPS=&quot;1&quot;;
                jumpto interface_sh;
fi</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">sed -n -e &quot;s/rsa_cert_file=.*$|        rsa_cert_file=.*$/rsa_cert_file=/ssl/certs/vsftpd.crt/p&quot; vsftpd.conf</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$STATE</span> -eq <span class="s2">&quot;0&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">source /etc/network/interfaces.d/<em>n
 str auto $( sed -n -e &quot;s/(autos).</em>/1$NET_ARR[$NET_WI]s$NET_ARR[$NET_EN]/p&quot;</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(source \/etc\/network\/interfaces/\\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos"> 3</span>                reinterfaces<span class="p">;</span>
<span class="linenos"> 4</span><span class="k">fi</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(auto\slo\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 7</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos"> 8</span>                reinterfaces<span class="p">;</span>
<span class="linenos"> 9</span><span class="k">fi</span>
<span class="linenos">10</span>sed -i -e <span class="s2">&quot;s/\(auto\s\).*/\1</span><span class="nv">$NET_WI</span><span class="s2"> </span><span class="nv">$NET_EN</span><span class="s2">/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">str iface NET_EN</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/\(iface\slo\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">TMPS=$(sed -n -e &quot;/(ifaceslo).*/{=;q;}&quot; interfaces)
sed -i -e &quot;$TMPS s/(ifaces).*/1$NET_EN inet dhcp/g&quot; interfaces</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/iface\slo.*/iface </span><span class="nv">$NET_EN</span><span class="s2"> inet dhcp/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">str allow-hotplug</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/\(allow-hotplug\s\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
<span class="linenos">5</span>sed -i -e <span class="s2">&quot;s/\(allow-hotplug\s\).*/\1</span><span class="nv">$NET_WI</span><span class="s2">/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">str iface NET_WI</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/\(iface\s\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"> str auto
TMPS=$(sed -n -e &quot;/(ifaces[en]).*/{=;q;}&quot; interfaces)</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span><span class="nv">$a</span><span class="s2"> s/\(iface\s\).*/\1</span><span class="nv">$NET_WI</span><span class="s2"> inet dhcp/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">sed -n -e &quot;s/(ifaces[en]).*/1$NET_ARR[$NET_WI] inet dhcp/g&quot; interfaces</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed <span class="s1">&#39;$a wpa-conf \/home\/rootsu\/wpa_supplicant.conf&#39;</span> interfaces &gt;&gt; interfaces<span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">if [[-z $( sed -n -e &quot;s/(autos).*/1/p&quot; interfaces) ]]; then
        jumpto interface_sh;
fi
systemctl restart wpa_supplicant&#64;$NET_ARR[$NET_WI]</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>systemctl restart wpa_supplicant
</pre></div>
</div>
<div class="line-block">
<div class="line">sed -n -e &quot;s/(autos).*/1$NET_ARR[$NET_WI]s$NET_ARR[$NET_EN]/g&quot; interfaces
 str iface NET_EN
if [[-z $( sed -n -e &quot;s/(ifaces).*/1/p&quot; interfaces) ]]; then
                jumpto interface_sh;
fi
sed -n -e &quot;s/(ifaces).*/1$NET_ARR[$NET_WI] inet dhcp/g&quot; interfaces
 str allow-hotplug</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">else</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(source \/etc\/network\/interfaces/\\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">4</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">5</span>                reinterfaces<span class="p">;</span>
<span class="linenos">6</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">str auto $( sed -n -e &quot;s/(autos).*/1$NET_ARR[$NET_WI]s$NET_ARR[$NET_EN]/p&quot;</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(auto\slo\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
<span class="linenos">5</span>sed -i -e <span class="s2">&quot;s/\(auto\s\).*/\1</span><span class="nv">$NET_EN</span><span class="s2">/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">str iface NET_EN</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(iface\slo\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
<span class="linenos">5</span>sed -i -e <span class="s2">&quot;s/iface\slo.*/iface </span><span class="nv">$NET_EN</span><span class="s2"> inet dhcp/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">str allow-hotplug</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(allow-hotplug\s\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
<span class="linenos">5</span>sed -i -e <span class="s2">&quot;s/\(allow-hotplug\s\).*/\1</span><span class="nv">$NET_EN</span><span class="s2">/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">str iface NET_WI</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/\(iface\s\).*/\1/p&quot;</span> interfaces<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>                <span class="nv">TMPS</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>                reinterfaces<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">TMPS=$(sed -n -e &quot;/(ifaces[en]).*/{=;q;}&quot; interfaces);</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span><span class="nv">$a</span><span class="s2"> s/\(iface\s\).*/\1</span><span class="nv">$NET_EN</span><span class="s2"> inet dhcp/g&quot;</span> interfaces
</pre></div>
</div>
<div class="line-block">
<div class="line">sed -n -e &quot;s/(ifaces[en]).*/1$NET_ARR[$NET_WI] inet dhcp/g&quot; interfaces
sed '$a wpa-conf /home/rootsu/wpa_supplicant.conf' interfaces &gt;&gt; interfaces;
sed -n -e &quot;s/(allow.*s).*/1$NET_ARR[$NET_WIFI]sinetsdhcp/g&quot; interfaces</div>
</div>
<blockquote>
<div><p>if [[ $STATE -eq &quot;0&quot; ]]; then fi</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="restart-service">
<h4><span class="section-number">4.1.3.3. </span>01.03.02        restart service<a class="headerlink" href="#restart-service" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>systemctl restart networking
<span class="linenos">2</span>
<span class="linenos">3</span><span class="nb">cd</span> /install/
<span class="linenos">4</span><span class="nb">echo</span> -e <span class="s2">&quot;1_settings_interface_with_wifi&quot;</span> &gt;&gt; steps.txt
<span class="linenos">5</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="update-distribution">
<h3><span class="section-number">4.1.4. </span>01.04           Update distribution<a class="headerlink" href="#update-distribution" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>step_one:
<span class="linenos">2</span>
<span class="linenos">3</span><span class="nb">cd</span> /install/
<span class="linenos">4</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(1_src_list\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">5</span>
<span class="linenos">6</span><span class="nb">cd</span> /etc/apt/
<span class="linenos">7</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span> lsb_release -d <span class="p">|</span> sed -n -e <span class="s1">&#39;s/.*(\([^\)]\+\))/\1/p&#39;</span><span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">echo &quot;Error: not defined version DebianOS, wait 3 sec&quot;;</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>        <span class="nv">DEB_VER</span><span class="o">=</span><span class="k">$(</span>cat /etc/os-release <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*(\([^\)].*\))\&quot;</span>$<span class="s2">/\1/p&quot;</span><span class="k">)</span><span class="p">;</span>
<span class="linenos">2</span>        <span class="nv">DEB_VER</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$DEB_VER</span> <span class="p">|</span> sed -n -e <span class="s2">&quot;s/\([a-z]*\)</span>$<span class="s2">//p&quot;</span><span class="k">)</span>
<span class="linenos">3</span><span class="k">else</span>
<span class="linenos">4</span>        <span class="nv">DEB_VER</span><span class="o">=</span><span class="k">$(</span> lsb_release -d <span class="p">|</span> sed -n -e <span class="s1">&#39;s/.*(\([^\)]\+\))/\1/p&#39;</span><span class="k">)</span>
<span class="linenos">5</span><span class="k">fi</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">cd /etc/apt/;
 rm sources.tmp;
touch sources.tmp</div>
</div>
<blockquote>
<div><p>main, contrib, non-free
main — здесь находятся пакеты соответствующие DFSG-compliant (Debian Free Software Guidelines) не требуют дополнительное ПО из других источников. Это часть дистрибутива Debian. Полностью свободны для любого использования.
contrib — смешанные пакеты которые содержат не только свободные пакеты DFSG-compliant но и пакеты из других веток например non-free.
non-free — не свободное программное обеспечение. Не соответствует DFSG.
check null string               ????            dob add usloviya proverki ft http</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -n <span class="k">$(</span>egrep -n <span class="s1">&#39;^[a-z] &amp;&amp; ^#&#39;</span> sources.list<span class="k">)</span> <span class="o">&amp;&amp;</span> -n <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/^deb http:\/\/ftp//p&quot;</span> sources.list<span class="k">)</span> <span class="o">&amp;&amp;</span> -n <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/^deb-src http:\/\/ftp//p&quot;</span> sources.list<span class="k">)</span> <span class="o">&amp;&amp;</span> -n <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/^deb http:\/\/deb//p&quot;</span> sources.list<span class="k">)</span> <span class="o">&amp;&amp;</span> -n <span class="k">$(</span> sed -n -e <span class="s2">&quot;s/^deb-src http:\/\/deb//p&quot;</span> sources.list<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span><span class="nv">STATE</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">;</span>
<span class="linenos">3</span>rm sources.list<span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">touch sources.tmp;</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nv">BUF</span><span class="o">=</span><span class="s2">&quot;#deb cdrom:[Debian GNU/Linux _*_ - Official amd64 NETINST 20210814-10:07]/ * main\ndeb http://ftp.debian.org/debian/ </span><span class="nv">$DEB_VER</span><span class="s2"> main non-free contrib\ndeb-src http://ftp.debian.org/debian/ </span><span class="nv">$DEB_VER</span><span class="s2"> main non-free contrib\n</span>
<span class="linenos"> 2</span><span class="s2">\ndeb http://security.debian.org/debian-security/ </span><span class="nv">$DEB_VER</span><span class="s2">-security main contrib non-free \ndeb-src http://security.debian.org/debian-security/ </span><span class="nv">$DEB_VER</span><span class="s2">-security main contrib non-free \n</span>
<span class="linenos"> 3</span><span class="s2">\n# *-updates, to get updates before a point release is made; \r\n# see https://www.debian.org/doc/manuals/debian-reference/ch02.en.html#_updates_and_backports \ndeb http://deb.debian.org/debian/ </span><span class="nv">$DEB_VER</span><span class="s2">-updates main contrib non-free \ndeb-src http://deb.debian.org/debian/ </span><span class="nv">$DEB_VER</span><span class="s2">-updates main contrib non-free \n</span>
<span class="linenos"> 4</span><span class="s2">\n</span>
<span class="linenos"> 5</span><span class="s2">        # This system was installed using small removable media \n</span>
<span class="linenos"> 6</span><span class="s2">        # (e.g. netinst, live or single CD). The matching \&quot;deb cdrom\&quot; \n</span>
<span class="linenos"> 7</span><span class="s2">        # entries were disabled at the end of the installation process. \n</span>
<span class="linenos"> 8</span><span class="s2">        # For information about how to configure apt package sources, \n</span>
<span class="linenos"> 9</span><span class="s2">        # see the sources.list(5) manual. \n&quot;</span>
<span class="linenos">10</span><span class="nb">echo</span> -e <span class="nv">$BUF</span> &gt; sources.list<span class="p">;</span>
<span class="linenos">11</span><span class="nb">echo</span> <span class="s2">&quot;Info: sources.list is null&quot;</span><span class="p">;</span>
<span class="linenos">12</span>sleep <span class="m">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Waits 5 seconds.
sed -i '34s/AAA/BBB/' file_name</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">else</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The first part of it is an &quot;address&quot;, i.e. the following command only applies to lines matching it. The ! negates the condition, i.e. the command will only be applied to lines not matching the address. So, in other words, Replace Hello by Hello world! on lines that don't contain Hello world!.
 sed -n -e 's/.*bullseye-[a-z](.)/1/p' sources.tmp
The pattern [a-z]* matches zero or more characters in the range a to z (the actual characters are dependent on the current locale). There are zero such characters at the very start of the string 123 abc (i.e. the pattern matches), and also four of them at the start of this is a line.
If you need at least one match, then use [a-z][a-z]* or [a-z]{1,}, or enable extended regular expressions with sed -E and use [a-z]+.</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> sed -i -e <span class="s2">&quot;s/</span><span class="nv">$DEB_VER</span><span class="s2">\s.*</span>$<span class="s2">/</span><span class="nv">$DEB_VER</span><span class="s2"> main contrib non-free/g&quot;</span> sources.list
<span class="linenos"> 2</span> sed -i -e <span class="s2">&quot;s/\(\/\s</span><span class="nv">$DEB_VER</span><span class="s2">\-[a-z]*\).*/\1 main contrib non-free/g&quot;</span> sources.list
<span class="linenos"> 3</span><span class="k">fi</span><span class="p">;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get update<span class="p">;</span>
<span class="linenos"> 6</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get full-upgrade<span class="p">;</span>
<span class="linenos"> 7</span><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 8</span> <span class="nb">echo</span> <span class="s2">&quot;Error: full upgrade error!!!&quot;</span>
<span class="linenos"> 9</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="linenos">10</span><span class="k">fi</span>
<span class="linenos">11</span><span class="nb">echo</span> -e <span class="s2">&quot;y\ny\ny\ny\n&quot;</span> <span class="p">|</span> apt-get install console-setup<span class="p">;</span>
<span class="linenos">12</span><span class="nb">cd</span> /install/
<span class="linenos">13</span><span class="nb">echo</span> -e <span class="s2">&quot;1_src_list&quot;</span> &gt;&gt; steps.txt
<span class="linenos">14</span>
<span class="linenos">15</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-drivers">
<h3><span class="section-number">4.1.5. </span>01.05           Install drivers<a class="headerlink" href="#install-drivers" title="Permalink to this headline"></a></h3>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>step_two:
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nb">cd</span> /install/
<span class="linenos"> 4</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(2_install_driver\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>lspci <span class="p">|</span> grep VGA <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*\[\(.*\)\/.*/\1/p&quot;</span><span class="k">)</span> <span class="o">==</span> <span class="s2">&quot;AMD&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 7</span>        <span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install libdrm-amdgpu1
<span class="linenos"> 8</span>        <span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install xserver-xorg-video-amdgpu
<span class="linenos"> 9</span><span class="k">else</span>
<span class="linenos">10</span>        <span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install nvidia-driver firmware-misc-nonfree nvidia-settings
<span class="linenos">11</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">apt-get install firmware-linux | apt-get install firmware-linux-nonfree | apt-get install firmware-linux | apt-get install firmware-realtek | apt-get install libdrm-amdgpu1 | apt-get install xserver-xorg-video-amdgpu  | apt-get install man</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install firmware-linux
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>lspci <span class="p">|</span> grep Ethernet <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*ller:\s\([a-zA-Z]\+\s\).*/\1/p&quot;</span><span class="k">)</span> <span class="o">==</span> <span class="s2">&quot;Realtek&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">4</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install firmware-realtek
<span class="linenos">5</span><span class="k">fi</span>
<span class="linenos">6</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install firmware-linux-nonfree
<span class="linenos">7</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install man
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="install-selinux-utils-acl">
<h4><span class="section-number">4.1.5.1. </span>01.05.01        Install SElinux utils &amp; acl<a class="headerlink" href="#install-selinux-utils-acl" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install acl
<span class="linenos">2</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install setools policycoreutils selinux-basics selinux-utils selinux-policy-default selinux-policy-mls auditd policycoreutils-python-utils semanage-utils audispd-plugins
<span class="linenos">3</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install mcstrans
<span class="linenos">4</span>
<span class="linenos">5</span>sudo systemctl <span class="nb">enable</span> auditd
<span class="linenos">6</span>sudo systemctl start auditd
</pre></div>
</div>
<div class="line-block">
<div class="line">policycoreutils-gui</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>touch /.autorelabel
<span class="linenos">2</span>selinux-activate
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">5</span> <span class="nb">echo</span> <span class="s2">&quot;Error: install driver failed!!!&quot;</span>
<span class="linenos">6</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="linenos">7</span><span class="k">fi</span>
<span class="linenos">8</span>
<span class="linenos">9</span><span class="nb">echo</span> -e <span class="s2">&quot;2_install_driver&quot;</span> &gt;&gt; steps.txt
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="reboot">
<h4><span class="section-number">4.1.5.2. </span>01.05.02        Reboot<a class="headerlink" href="#reboot" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>reboot
<span class="linenos">2</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="install-git-nanorc-step-three">
<h3><span class="section-number">4.1.6. </span>01.06           Install git &amp;&amp; nanorc [step_three]<a class="headerlink" href="#install-git-nanorc-step-three" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(3_nanorc\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"> nano /etc/rc.local
setupcon</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install git
<span class="linenos">2</span><span class="k">if</span> <span class="o">[</span>
<span class="linenos">3</span>? -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">4</span> <span class="nb">echo</span> <span class="s2">&quot;Error: error install git!!!&quot;</span>
<span class="linenos">5</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span>
<span class="linenos">6</span><span class="k">fi</span>
<span class="linenos">7</span><span class="nb">cd</span> /install
<span class="linenos">8</span>git clone git://git.savannah.gnu.org/nano.git<span class="p">;</span> <span class="nb">cd</span> nano<span class="p">;</span>./autogen.sh<span class="p">;</span>./configure<span class="p">;</span> make install
</pre></div>
</div>
<div class="line-block">
<div class="line">rm -Rf /nano/
rmdir /nano/
git clone <a class="reference external" href="https://github.com/nanorc/nanorc.git">https://github.com/nanorc/nanorc.git</a>
cd nanorc
make install
exit 1;
 make list all autogen
cat ~/.nano/syntax/ALL.nanorc
rm ~/.nanorc
touch ~/.nanorc
echo -e 'include ~/.nano/syntax/ALL.nanorc' &gt;&gt; ~/.nanorc
         TeX
echo -e 'include &quot;/usr/share/nano/patch.nanorc' &gt;&gt; ~/.nanorc
         POV-Ray
echo -e 'include &quot;/usr/share/nano/pov.nanorc' &gt;&gt; ~/.nanorc
         Perl
echo -e 'include &quot;/usr/share/nano/perl.nanorc' &gt;&gt; ~/.nanorc
         Nanorc files
echo -e 'include &quot;/usr/share/nano/nanorc.nanorc' &gt;&gt; ~/.nanorc
         Python
echo -e 'include &quot;/usr/share/nano/python.nanorc' &gt;&gt; ~/.nanorc
         C/C++
echo -e 'include &quot;/usr/share/nano/c.nanorc' &gt;&gt; ~/.nanorc
         Groff
echo -e 'include &quot;/usr/share/nano/groff.nanorc' &gt;&gt; ~/.nanorc
         Assembler
echo -e 'include &quot;/usr/share/nano/asm.nanorc' &gt;&gt; ~/.nanorc
         Ruby
echo -e 'include &quot;/usr/share/nano/ruby.nanorc' &gt;&gt; ~/.nanorc
         Manpages
echo -e 'include &quot;/usr/share/nano/man.nanorc' &gt;&gt; ~/.nanorc
         HTML
echo -e 'include &quot;/usr/share/nano/html.nanorc' &gt;&gt; ~/.nanorc
         Bourne shell scripts
echo -e 'include &quot;/usr/share/nano/sh.nanorc' &gt;&gt; ~/.nanorc
         Sun Java
echo -e 'include &quot;/usr/share/nano/java.nanorc' &gt;&gt; ~/.nanorc
         Sun php
echo -e 'include &quot;/usr/share/nano/php.nanorc' &gt;&gt; ~/.nanorc
         Sun perl
echo -e 'include &quot;/usr/share/nano/perl.nanorc' &gt;&gt; ~/.nanorc
         sql
echo -e 'include &quot;/usr/share/nano/sql.nanorc' &gt;&gt; ~/.nanorc
         asm
echo -e 'include &quot;/usr/share/nano/asm.nanorc' &gt;&gt; ~/.nanorc
include &quot;/usr/share/nano/<a href="#id3"><span class="problematic" id="id4">*</span></a>.nanorc&quot;</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>find /usr/share/nano -name <span class="s1">&#39;*.nanorc&#39;</span> -printf <span class="s2">&quot;include %p\n&quot;</span> &gt; ~/.nanorc
</pre></div>
</div>
<div class="line-block">
<div class="line">for i in <cite>ls /usr/share/nano</cite>
  do
    echo &quot;include /usr/share/nano/$i&quot; &gt;&gt; ~/.nanorc
  done
rm -Rf /nanorc/
rmdir /nanorc/</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">fi</span>
<span class="linenos">2</span><span class="nb">echo</span> -e <span class="s2">&quot;3_nanorc&quot;</span> &gt;&gt; steps.txt
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="copy-dir">
<h3><span class="section-number">4.1.7. </span>01.07           Copy dir<a class="headerlink" href="#copy-dir" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(4_copy_sh\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> /install/
<span class="linenos">2</span>cp -Rf /install/home/* /home/
<span class="linenos">3</span>cp -Rf /install/home/rootsu/.bashrc ~root
<span class="linenos">4</span>cp -Rf /install/home/rootsu/.profile ~root
<span class="linenos">5</span>cp -Rf /install/home/rootsu/.cmd_shell.sh ~root
<span class="linenos">6</span>
<span class="linenos">7</span>cp -Rf /install/home/rootsu/* ~root
<span class="linenos">8</span>chmod ug+rwx -Rf ~root
</pre></div>
</div>
<div class="line-block">
<div class="line"> cp -Rf /install/home/admin/.bashrc /root/
cp /etc/nanorc ~/.nanorc</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;4_copy_sh&quot;</span> &gt;&gt; steps.txt
<span class="linenos">2</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">exit 1;
cp -Rf /install/home/ /home/     -&gt; rootsu, admin
 <a class="reference external" href="https://superuser.com/questions/904001/how-to-install-tar-xz-file-in-ubuntu">https://superuser.com/questions/904001/how-to-install-tar-xz-file-in-ubuntu</a></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-utils-step-five">
<h3><span class="section-number">4.1.8. </span>01.08           Install utils [step_five]<a class="headerlink" href="#install-utils-step-five" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(5_install_util_wd\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install build-essential
<span class="linenos">2</span><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">3</span> <span class="nb">echo</span> <span class="s2">&quot;Error: error install gcc-utils!!!&quot;</span>
<span class="linenos">4</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="linenos">5</span><span class="k">fi</span>
<span class="linenos">6</span>
<span class="linenos">7</span>add-apt-repository-get ppa:ubuntu-toolchain-r/test <span class="o">&amp;&amp;</span> apt update
</pre></div>
</div>
<div class="line-block">
<div class="line"><a class="reference external" href="https://pcp.io/docs/guide.html">https://pcp.io/docs/guide.html</a>
apt-get install gcc-snapshot &amp;&amp; apt-get install gcc-11g++-11
update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 60 --slave /usr/bin/g++ g++ /usr/bin/g++-9</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install python
<span class="linenos">2</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install python3
<span class="linenos">3</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install tmux<span class="p">;</span>
<span class="linenos">4</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install net-tools
<span class="linenos">5</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install manpages-dev<span class="p">;</span>
<span class="linenos">6</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install wpa_supplicant<span class="p">;</span>
<span class="linenos">7</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install mc<span class="p">;</span>
<span class="linenos">8</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install ncdu<span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">echo -e &quot;yn&quot; | apt-get install monitorix;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install netdata<span class="p">;</span>
<span class="linenos"> 2</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install systat<span class="p">;</span>
<span class="linenos"> 3</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install iftop<span class="p">;</span>
<span class="linenos"> 4</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install htop<span class="p">;</span>
<span class="linenos"> 5</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install sudo<span class="p">;</span>
<span class="linenos"> 6</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install iptraf<span class="p">;</span>
<span class="linenos"> 7</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install ntp
<span class="linenos"> 8</span>systemctl <span class="nb">enable</span> ntp<span class="p">;</span>
<span class="linenos"> 9</span>systemctl <span class="nb">enable</span> start<span class="p">;</span>
<span class="linenos">10</span>sudo systemctl unmask samba<span class="p">;</span>
<span class="linenos">11</span>cp /install/etc/sudoers /etc/sudoers
<span class="linenos">12</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install nmon<span class="p">;</span>
<span class="linenos">13</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install nmap<span class="p">;</span>
<span class="linenos">14</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install safe-rm
<span class="linenos">15</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install aptitude
</pre></div>
</div>
<div class="line-block">
<div class="line">echo -e &quot;yn&quot; | apt-get install iptables</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>iptables –F
<span class="linenos"> 2</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install cifs-utils
<span class="linenos"> 3</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install samba
<span class="linenos"> 4</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install smbfs
<span class="linenos"> 5</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install whois
<span class="linenos"> 6</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install lsof
<span class="linenos"> 7</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install mkpasswd
<span class="linenos"> 8</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install wget
<span class="linenos"> 9</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install tree
<span class="linenos">10</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install autofs
<span class="linenos">11</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install gpg
<span class="linenos">12</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install rsync
<span class="linenos">13</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install ca-certificates
<span class="linenos">14</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install shared-mime-info
<span class="linenos">15</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install wget genisoimage xorriso isolinux
<span class="linenos">16</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install hddtemp lm-sensors
<span class="linenos">17</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install at
<span class="linenos">18</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install pip
<span class="linenos">19</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install xz-utils
<span class="linenos">20</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install curl
<span class="linenos">21</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install python3-sphinx
<span class="linenos">22</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> sudo apt install -y build-essential libssl-dev libffi-dev python3-dev
<span class="linenos">23</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> sudo apt install -y python3-venv
<span class="linenos">24</span>python3 -m venv env
<span class="linenos">25</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install python3-sphinx
<span class="linenos">26</span>pip install --upgrade myst-parser
</pre></div>
</div>
<div class="line-block">
<div class="line">pip install mkdocs
pip install -U mkdocs
pip install mkdocs-rtd-dropdown</div>
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>pip install sphinx-autodocgen
<span class="linenos">2</span>pip install Pygments
<span class="linenos">3</span>pip install sphinx-intl
<span class="linenos">4</span>pip install lumache
<span class="linenos">5</span>pip install django
<span class="linenos">6</span>pip install django-docs
<span class="linenos">7</span>pip install sphinxnotes-strike
</pre></div>
</div>
<div class="line-block">
<div class="line">Install Sphinx</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>pip install -U sphinx
<span class="linenos">2</span>python -m venv .venv
</pre></div>
</div>
<div class="line-block">
<div class="line">echo -e &quot;yn&quot; | apt-get install anacron</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>systemctl <span class="nb">enable</span> cron
</pre></div>
</div>
<div class="line-block">
<div class="line">systemctl enable anacron
echo -e &quot;yn&quot; | apt-get install postfix
 Nmap Ngrep VnStat Iptraf-ng NetHogs Iotop dd dh netcat</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>systemctl <span class="nb">enable</span> autofs
</pre></div>
</div>
<div class="line-block">
<div class="line">systemctl start autofs
echo -e &quot;yn&quot; | apt-get install selinux-basics selinux-policy-default auditd
echo -e &quot;yn&quot; | apt-get install setools policycoreutils selinux-basics selinux-utils selinux-policy-default selinux-policy-mls  auditd policycoreutils-python-utils semanage-utils
setroubleshoot selinux-policy-targeted</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>apt-get install openssh-server -y
<span class="linenos">2</span><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">3</span> <span class="nb">echo</span> <span class="s2">&quot;Error: error install setup-utils!!!&quot;</span>
<span class="linenos">4</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="linenos">5</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">exit 1;</div>
</div>
<blockquote>
<div><p>Update settings LOCALE</p>
<p>locale -a</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>update-locale <span class="nv">LC_TIME</span><span class="o">=</span>ru_RU.UTF-8<span class="p">;</span>
<span class="linenos"> 2</span>update-locale <span class="nv">LC_ALL</span><span class="o">=</span>ru_RU.UTF-8<span class="p">;</span>
<span class="linenos"> 3</span>update-locale <span class="nv">LANG</span><span class="o">=</span>ru_RU.UTF-8<span class="p">;</span>
<span class="linenos"> 4</span>sed -n -e <span class="s2">&quot;s/\(=\).*/\1\&quot;</span><span class="nv">$ru_RU</span><span class="s2">.UTF-8\&quot;/p&quot;</span> /etc/default/locale
<span class="linenos"> 5</span>update-locale<span class="p">;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>cp -Rf /install/etc/* /etc
<span class="linenos"> 8</span><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 9</span> <span class="nb">echo</span> <span class="s2">&quot;Error: copy install to etc&quot;</span>
<span class="linenos">10</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="linenos">11</span><span class="k">fi</span>
<span class="linenos">12</span><span class="nb">cd</span> /install/
<span class="linenos">13</span><span class="nb">echo</span> -e <span class="s2">&quot;5_install_util_wd&quot;</span> &gt;&gt; steps.txt
</pre></div>
</div>
<div class="line-block">
<div class="line">exit 1;</div>
</div>
<blockquote>
<div><dl class="simple">
<dt>echo &quot;Press ESC key to quit and reboot&quot;</dt><dd><p>read a single character</p>
</dd>
</dl>
<p>while read -r -n1 key
do</p>
<blockquote>
<div><p>if input == ESC key</p>
</div></blockquote>
<p>if [[ $key == $'e' ]];
then</p>
<blockquote>
<div><p>reboot;</p>
</div></blockquote>
<p>fi
done</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">dpkg -i xz-utils_5.2.4-1_amd64.deb
tar -xvf wpa_supplicant-0.7.3.tar.gz
cd ./wpa_supplicant-0.7.3/
mv /install/.config /install/wpa_supplicant-0.7.3/wpa_supplicant/
bash make
exit 1;
tar -xvf console-setup_1.205.tar.xz
cd ./console-setup-1.205.tar.xz/
./configure
./install
cp -Rf /install/etc/default/console-setup /etc/default/</div>
</div>
<blockquote>
<div><dl class="simple">
<dt>if [ -f /etc/resolv.conf ]; then</dt><dd><p>jumpto STEP_TWO_AFTER;</p>
</dd>
</dl>
<p>fi</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>step_three:
</pre></div>
</div>
<div class="line-block">
<div class="line">Search
add-apt-repository ppa:un-brice/ppa
apt-get update
apt-get install shake-fs</div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-driver-opt-and-acc-step-six">
<h3><span class="section-number">4.1.9. </span>01.09           Install driver opt and acc [step_six]<a class="headerlink" href="#install-driver-opt-and-acc-step-six" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>step_four:
<span class="linenos">2</span><span class="nb">cd</span> /install/
<span class="linenos">3</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(7_driver_opt\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="create-disk-opt">
<h4><span class="section-number">4.1.9.1. </span>01.09.01        create disk /opt/<a class="headerlink" href="#create-disk-opt" title="Permalink to this headline"></a></h4>
</div>
<div class="section" id="search-dev-s">
<h4><span class="section-number">4.1.9.2. </span>01.09.02        search /dev/s**<a class="headerlink" href="#search-dev-s" title="Permalink to this headline"></a></h4>
<blockquote>
<div><p>touch fdiskhdd.txt;
fdisk -l &gt; fdiskhdd.txt
STATE=$(sed -n -e &quot;s/.*(/dev/s[a-z]*[0-9]).*/1/p&quot; fdiskhdd.txt);
if [[ -z $(sed -n -e &quot;s/.*(/dev/s[a-z]*).*/1/p&quot; fdiskhdd.txt) ]]; then</p>
<blockquote>
<div><p>STATE=$(sed -n -e &quot;s/.*(/dev/s[a-z]*).*/1/p&quot; fdiskhdd.txt);</p>
</div></blockquote>
<p>fi</p>
<blockquote>
<div><p>OPTIONS: g , w</p>
</div></blockquote>
<p>echo &quot;ngnnn1n2048nnw&quot; |  fdisk $STATE --wipe AUTO</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Create fs</div>
</div>
<blockquote>
<div><p>mkfs.ext4 $STATE /opt</p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mount-dev-s">
<h4><span class="section-number">4.1.9.3. </span>01.09.03        mount /dev/s**<a class="headerlink" href="#mount-dev-s" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>mount -t ext4 <span class="k">$(</span>sudo fdisk -l <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*\(\/dev\/s[a-z]*[0-9]\).*/\1/p&quot;</span><span class="k">)</span> /opt
<span class="linenos">2</span>
<span class="linenos">3</span><span class="nv">shd</span><span class="o">=</span><span class="k">$(</span>sudo fdisk -l <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*\(\/dev\/s[a-z]*[0-9]\).*/\1/p&quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/\//\\\//g&#39;</span><span class="k">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">S1=$(sudo blkid | sed -n -e &quot;s/$shd:s(.*).*/1/p&quot; | sed -n -e &quot;s/$shd:s([=a-<a href="#id8"><span class="problematic" id="id9">zA-Z_</span></a>]*)/1/p;s/UUID=(.*)sB.*/1/p&quot; | sed 's/&quot;/\&quot;/g')</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nv">S1</span><span class="o">=</span><span class="k">$(</span>sudo blkid <span class="p">|</span> sed -n -e <span class="s2">&quot;s/</span><span class="nv">$shd</span><span class="s2">:\s\(.*\).*/\1/p&quot;</span> <span class="p">|</span> sed -n -e <span class="s2">&quot;s/UUID=\(.*\)\sB.*/\1/p&quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/\&quot;/\\&quot;/g&#39;</span><span class="k">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a UUID\=</span><span class="nv">$S1</span><span class="s2">        \/opt\/ ext4    defaults        0       2&quot;</span> /etc/fstab
<span class="linenos">4</span>
<span class="linenos">5</span>sudo mount -a
</pre></div>
</div>
<div class="line-block">
<div class="line">if [[ -z $STATE ]]; then
        exit 3;
fi
                1_1_3_2 create disk /dev/s**</div>
</div>
<blockquote>
<div><p><a class="reference external" href="https://www.computerhope.com/unix/fdisk.htm">https://www.computerhope.com/unix/fdisk.htm</a>
<a class="reference external" href="https://superuser.com/questions/332252/how-to-create-and-format-a-partition-using-a-bash-script">https://superuser.com/questions/332252/how-to-create-and-format-a-partition-using-a-bash-script</a></p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;7_driver_opt&quot;</span> &gt;&gt; steps.txt
<span class="linenos">2</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> /install/
</pre></div>
</div>
<div class="line-block">
<div class="line">        in-target mkfs.ext4 /dev/sdb1 ; in-target echo &quot;/dev/sdb1  /srv  ext4  nodiratime  0  2&quot; &gt;&gt; /etc/fstab
                      ???
      fdisk
      mkfs</div>
</div>
<blockquote>
<div><p>1_1_4   editor /etc/apt/sources.list
add info ro &quot;contrib non-free|</p>
<p>copy sources.list -&gt; sources.tmp</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><a class="reference external" href="https://www.baeldung.com/linux/run-script-on-startup">https://www.baeldung.com/linux/run-script-on-startup</a></div>
</div>
<blockquote>
<div><p>cp /install/pii2.sh /etc/init.d/
chkconfig --add pii2.sh
update-rc.d pii2.sh defaults</p>
<p>touch /install/step_two.txt</p>
<blockquote>
<div><blockquote>
<div><p>Posle del!!!</p>
</div></blockquote>
<p><a class="reference external" href="https://serverfault.com/questions/32438/disable-a-service-from-starting-at-all-runlevels">https://serverfault.com/questions/32438/disable-a-service-from-starting-at-all-runlevels</a></p>
</div></blockquote>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Jump to label interface_sh</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="create-users-and-groups">
<h3><span class="section-number">4.1.10. </span>01.10           Create users and groups<a class="headerlink" href="#create-users-and-groups" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(9_user_settings\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos">2</span>
<span class="linenos">3</span>STEP_TWO_AFTER:
</pre></div>
</div>
<div class="line-block">
<div class="line">cp sources.tmp sources.list;</div>
<div class="line"><br /></div>
</div>
<div class="section" id="id5">
<h4><span class="section-number">4.1.10.1. </span>01.10.01                Create users and groups<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<blockquote>
<div><p>cp -Rf /install/home/rootsu/.cmd_shell.sh ~/.cmd_shell.sh
cp -Rf /install/home/rootsu/.bashrc ~/.bashrc
cp -Rf /install/home/rootsu/.bashrc /home/admin/
cp -Rf /install/home/rootsu/.cmd_shell.sh /home/admin/
В</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> groupadd -g <span class="m">1000</span> admins
<span class="linenos"> 2</span> groupadd -g <span class="m">2000</span> exp_users
<span class="linenos"> 3</span> groupadd -g <span class="m">3000</span> pro_users
<span class="linenos"> 4</span> groupadd -g <span class="m">4000</span> moderators
<span class="linenos"> 5</span> groupadd -g <span class="m">5000</span> technics
<span class="linenos"> 6</span> groupadd -g <span class="m">6000</span> ps_users
<span class="linenos"> 7</span> groupadd -g <span class="m">7000</span> others
<span class="linenos"> 8</span> useradd -u <span class="m">1100</span> -g admins -c <span class="s2">&quot;admin&quot;</span> -s /bin/bash -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m admin
<span class="linenos"> 9</span>
<span class="linenos">10</span> useradd -u <span class="m">1200</span> -g admins -c <span class="s2">&quot;admin&quot;</span> -s /bin/bash -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m admin_tech
<span class="linenos">11</span>usermod -aG sudo,technics,root admin
<span class="linenos">12</span>usermod -aG sudo,technics,root admin_tech
<span class="linenos">13</span>
<span class="linenos">14</span>cp /install/home/rootsu/.bashrc /home/admin/
<span class="linenos">15</span>cp /install/home/rootsu/.profile /home/admin/
<span class="linenos">16</span>cp /install/home/rootsu/.cmd_shell.sh /home/admin/
<span class="linenos">17</span>
<span class="linenos">18</span> useradd -u <span class="m">2100</span> -g exp_users -s /bin/bash -c <span class="s2">&quot;far_exp&quot;</span> -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m far_exp
<span class="linenos">19</span> useradd -u <span class="m">3100</span> -g pro_users -s /bin/bash -c <span class="s2">&quot;far_pro&quot;</span> -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m far_pro
<span class="linenos">20</span> useradd -u <span class="m">4100</span> -g moderators -s /bin/bash -c <span class="s2">&quot;far_moderator&quot;</span> -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m far_mod
<span class="linenos">21</span> useradd -u <span class="m">5100</span> -g technics -d /opt/SAMBA_SHARE/ -s /bin/false -c <span class="s2">&quot;technical admin_share&quot;</span> -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> admin_share
<span class="linenos">22</span> useradd -u <span class="m">5200</span> -g technics -d /opt/SAMBA_SHARE/ -s /bin/false -c <span class="s2">&quot;technical pub_share&quot;</span> -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> pub_share
<span class="linenos">23</span> useradd -u <span class="m">6100</span> -g ps_users -s /bin/bash -c <span class="s2">&quot;far_user&quot;</span> -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m far_user
</pre></div>
</div>
<div class="line-block">
<div class="line">useradd -u 6100 -g users -s /bin/bash -c &quot;test&quot; -p &quot;&quot; -m test</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>useradd -g ps_users -c <span class="s2">&quot;tom&quot;</span> -s /bin/bash -p <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;********&quot;</span> <span class="p">|</span> mkpasswd -s -H MD5<span class="k">)</span> -m tom
</pre></div>
</div>
<div class="line-block">
<div class="line">smbpasswd -a -w &quot;&quot; admin_share</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;********\n********&quot;</span> <span class="p">|</span> smbpasswd -a admin_share
<span class="linenos">2</span><span class="nb">echo</span> -e <span class="s2">&quot;********\n********&quot;</span> <span class="p">|</span> smbpasswd -a pub_share
<span class="linenos">3</span>smbpasswd -e admin_share
<span class="linenos">4</span>smbpasswd -e pub_share
</pre></div>
</div>
<div class="line-block">
<div class="line">smbpasswd -a -w &quot;&quot; pub_share
if [ $? -ne 0 ]; then********</div>
</div>
<blockquote>
<div><p>fi</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>mkdir /opt/SAMBA_SHARE
<span class="linenos"> 2</span>mkdir /mnt/SMB
<span class="linenos"> 3</span>mkdir /mnt/SMB/SOFT_2TBSEAGREEN
<span class="linenos"> 4</span>mkdir /mnt/SMB/SOFT_3TBSEASYAN
<span class="linenos"> 5</span>mkdir /media/admin
<span class="linenos"> 6</span>chown admin:admins /media/admin
<span class="linenos"> 7</span>chown -R :technics /opt/ /opt/SAMBA_SHARE /mnt/SMB
<span class="linenos"> 8</span>chown -R admin_share:technics /opt/ /opt/SAMBA_SHARE /mnt/SMB
<span class="linenos"> 9</span>chmod ug+rw /opt/ /opt/SAMBA_SHARE /mnt/SMB
<span class="linenos">10</span>setfacl -m u:pub_share:rwx,u:admin_share:rwx -R <span class="s2">&quot;/mnt/SMB&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">chown -R admin_share:technics,pub_share:technics /mnt/SMB</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="create-ssh-ssl">
<h4><span class="section-number">4.1.10.2. </span>01.10.02                Create ssh_ssl<a class="headerlink" href="#create-ssh-ssl" title="Permalink to this headline"></a></h4>
<blockquote>
<div><p><a class="reference external" href="https://www.cyberciti.biz/tips/checking-openssh-sshd-configuration-syntax-errors.html">https://www.cyberciti.biz/tips/checking-openssh-sshd-configuration-syntax-errors.html</a></p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-ssh-settings">
<h4><span class="section-number">4.1.10.3. </span>01.10.03        Install ssh settings<a class="headerlink" href="#install-ssh-settings" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> /etc/ssh/
<span class="linenos">2</span>
<span class="linenos">3</span>cp sshd_config sshd_config.tmp
</pre></div>
</div>
<div class="line-block">
<div class="line">Port 22</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#Port\s.*</span>$<span class="s2">\|Port\s.*</span>$<span class="s2">/Port </span><span class="nv">$PORT_SSH</span><span class="s2">/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">HostKey</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#HostKey/HostKey/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">PubkeyAuthentification</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#PubkeyAuthentication\s.*</span>$<span class="s2">\|PubkeyAuthentication\s.*</span>$<span class="s2">/PubkeyAuthentication yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">SysLogFacility</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#SysLogFacility\s.*</span>$<span class="s2">\|SysLogFacility\s.*</span>$<span class="s2">/SysLogFacility AUTHPRIV/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">LogLevel</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#LogLevel\s.*</span>$<span class="s2">\|LogLevel\s.*</span>$<span class="s2">/#LogLevel INFO/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">LogLevel</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#LoginGraceTime\s.*</span>$<span class="s2">\|LoginGraceTime\s.*</span>$<span class="s2">/LoginGraceTime 2m/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">PermitRootLogin</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#PermitRootLogin\s.*</span>$<span class="s2">\|PermitRootLogin\s.*</span>$<span class="s2">/PermitRootLogin yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">StrictModes</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#StrictModes\s.*</span>$<span class="s2">\|StrictModes\s.*</span>$<span class="s2">/StrictModes no/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">MaxAuthTries</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#MaxAuthTries\s.*</span>$<span class="s2">\|MaxAuthTries\s.*</span>$<span class="s2">/MaxAuthTries 3/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">MaxAuthTries</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#MaxSessions\s.*</span>$<span class="s2">\|MaxSessions\s.*</span>$<span class="s2">/MaxSessions 3/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p>AuthorizedKeysFile</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#AuthorizedKeysFile\s.*</span>$<span class="s2">\|AuthorizedKeysFile\s.*</span>$<span class="s2">/AuthorizedKeysFile \/home\/rootsu\/.ssh\/authorized_keys \/home\/%u\/.ssh\/authorized_keys/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">PasswordAuthentication no</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#PasswordAuthentication\s.*</span>$<span class="s2">\|PasswordAuthentication\s.*</span>$<span class="s2">/PasswordAuthentication no/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">PermitEmptyPasswords no</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#PermitEmptyPasswords\s.*</span>$<span class="s2">\|PermitEmptyPasswords\s.*</span>$<span class="s2">/PermitEmptyPasswords no/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">ChallengeResponseAuthentification</div>
</div>
<blockquote>
<div><p>sed -n -e &quot;s/ChallengeResponseAuthentication.*$|      ChallengeResponseAuthentication.*$/ChallengeResponseAuthentification yes/p&quot; sshd_config.tmp</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/ChallengeResponseAuthentication.*</span>$<span class="s2">\|#ChallengeResponseAuthentication.*</span>$<span class="s2">/ChallengeResponseAuthentication yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">UsePAM yes</div>
</div>
<blockquote>
<div><p>sed -n -e &quot;s/  UsePAMs.*$|UsePAMs.*$/UsePAM yes/p&quot; sshd_config.tmp</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#UsePAM\s.*</span>$<span class="s2">\|UsePAM\s.*</span>$<span class="s2">/UsePAM yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">AllowTcpForwarding yes</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#AllowTcpForwarding\s.*</span>$<span class="s2">\|AllowTcpForwarding\s.*</span>$<span class="s2">/AllowTcpForwarding yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">X11Forwarding yes</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#X11Forwarding\s.*</span>$<span class="s2">\|X11Forwarding\s.*</span>$<span class="s2">/X11Forwarding yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">X11DisplayOffset yes</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#X11DisplayOffset\s.*</span>$<span class="s2">\|X11DisplayOffset\s.*</span>$<span class="s2">/X11DisplayOffset 10/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">PrintMotd no</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/#PrintMotd\s.*</span>$<span class="s2">\|PrintMotd\s.*</span>$<span class="s2">/PrintMotd yes/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line">Subsystem</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> sed -i -e <span class="s2">&quot;s/Subsystem\s/#Subsystem\s/g&quot;</span> sshd_config
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>systemctl restart ssh
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="create-users-ssh">
<h4><span class="section-number">4.1.10.4. </span>01.10.04        Create users ssh<a class="headerlink" href="#create-users-ssh" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sudo bash ~/.cmd_shell.sh --mode <span class="s2">&quot;ssh_keygen&quot;</span> --uadd <span class="s2">&quot;tom&quot;</span> --gadd <span class="s2">&quot;ps_users&quot;</span> --pwd <span class="s2">&quot;debian&quot;</span>
<span class="linenos">2</span>bash ~/.cmd_shell.sh --mode <span class="s2">&quot;ssh_keygen&quot;</span> --uadd <span class="s2">&quot;admin&quot;</span> --gadd <span class="s2">&quot;admins&quot;</span> --pwd <span class="s2">&quot;debian&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="create-samba">
<h4><span class="section-number">4.1.10.5. </span>01.10.05        Create SAMBA<a class="headerlink" href="#create-samba" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>mount -v -t cifs //192.168.1.1/SOFT_2TBSEAGREEN//mnt/SMB/SOFT_2TBSEAGREEN -o <span class="nv">credentials</span><span class="o">=</span>/home/rootsu/.smbusers,defcontext<span class="o">=</span><span class="s2">&quot;system_u:object_r:samba_share_t:s0&quot;</span><span class="p">;</span>
<span class="linenos"> 2</span>mount -v -t cifs //192.168.1.1/SOFT_3TBSEASYAN//mnt/SMB/SOFT_3TBSEASYAN -o <span class="nv">credentials</span><span class="o">=</span>/home/rootsu/.smbusers,defcontext<span class="o">=</span><span class="s2">&quot;system_u:object_r:samba_share_t:s0&quot;</span><span class="p">;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>cp -Rf /install/etc/autofs /etc/
<span class="linenos"> 5</span>cp -Rf /install/etc/autofs.conf /etc/
<span class="linenos"> 6</span>cp -Rf /install/etc/samba /etc/
<span class="linenos"> 7</span>cp -Rf /install/lib/ /lib/
<span class="linenos"> 8</span>chmod <span class="m">644</span> -Rf /etc/autofs/
<span class="linenos"> 9</span>
<span class="linenos">10</span>systemctl restart autofs
<span class="linenos">11</span>systemctl restart smbd
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-and-settings-firewall">
<h4><span class="section-number">4.1.10.6. </span>01.10.06        Install and settings firewall<a class="headerlink" href="#install-and-settings-firewall" title="Permalink to this headline"></a></h4>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-other-soft">
<h4><span class="section-number">4.1.10.7. </span>01.10.07        Install other soft<a class="headerlink" href="#install-other-soft" title="Permalink to this headline"></a></h4>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="extended-nano">
<h4><span class="section-number">4.1.10.8. </span>01.10.08        Extended nano<a class="headerlink" href="#extended-nano" title="Permalink to this headline"></a></h4>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="cp-ers">
<h4><span class="section-number">4.1.10.9. </span>01.10.09        cp ers<a class="headerlink" href="#cp-ers" title="Permalink to this headline"></a></h4>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y&quot;</span> <span class="p">|</span> apt-get install ntfs-3g<span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">exit 1;</div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="install-vsftp">
<h4><span class="section-number">4.1.10.10. </span>01.10.10        Install vsftp<a class="headerlink" href="#install-vsftp" title="Permalink to this headline"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y&quot;</span> <span class="p">|</span> sudo apt install vsftpd
<span class="linenos">2</span>
<span class="linenos">3</span><span class="nb">cd</span> /etc/
<span class="linenos">4</span>sudo cp /etc/vsftpd.conf/etc/vsftpd.conf_default
</pre></div>
</div>
<div class="line-block">
<div class="line">Listen=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/listen=.*</span>$<span class="s2">/listen=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">listen_ipv6=</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/listen_ipv6=.*</span>$<span class="s2">/listen_ipv6=NO/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">annonymous_enable=NO</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#anonymous_enable=.*</span>$<span class="s2">\|anonymous_enable=.*</span>$<span class="s2">/anonymous_enable=NO/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">anon_upload_enable=NO</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#anon_upload_enable=.*</span>$<span class="s2">\|anon_upload_enable=.*</span>$<span class="s2">/anon_upload_enable=NO/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">anon_mkdir_write_enable=NOanon_mkdir_write_enable=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/anon_mkdir_write_enable=.*</span>$<span class="s2">\|#anon_mkdir_write_enable=.*</span>$<span class="s2">/anon_mkdir_write_enable=NO/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">write_enable=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#write_enable=.*</span>$<span class="s2">\|write_enable=.*</span>$<span class="s2">/write_enable=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">local_umask=022</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#local_umask=.*</span>$<span class="s2">\|local_umask=.*</span>$<span class="s2">/local_umask=022/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">connect_from_port 20</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/connect_from_port_20=.*</span>$<span class="s2">/connect_from_port_20=NO/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">local_umask=022</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#ascii_upload_enable=.*</span>$<span class="s2">\|ascii_upload_enable=.*</span>$<span class="s2">/ascii_upload_enable=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ascii_upload_enable=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#ascii_upload_enable=.*</span>$<span class="s2">\|ascii_upload_enable=.*</span>$<span class="s2">/ascii_upload_enable=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ascii_download_enable=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#ascii_download_enable=.*</span>$<span class="s2">\|ascii_download_enable=.*</span>$<span class="s2">/ascii_download_enable=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ftpd_banner=</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#ftpd_banner=.*</span>$<span class="s2">\|ftpd_banner=.*</span>$<span class="s2">/ftpd_banner=Welcome to </span><span class="nv">$HOSTNAME</span><span class="s2">!!!/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">|      restrict FTP users to their /home directory and allow them to write there
 mogut switch from home / YES yes restrict privilege
sed -i -e &quot;s/   chroot_local_user=.*$|chroot_local_user=.*$/chroot_local_user=YES/g&quot; vsftpd.conf</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;0,/#chroot_local_user=.*</span>$<span class="s2">\|chroot_local_user=.*</span>$<span class="s2">/ s//chroot_local_user=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">is_recurse_enable -R</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#ls_recurse_enable=.*</span>$<span class="s2">\|ls_recurse_enable=.*</span>$<span class="s2">/ls_recurse_enable=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">chroot_list_file=/etc/vsftpd.chroot_list/</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#chroot_list_file=.*</span>$<span class="s2">\|chroot_list_file=.*</span>$<span class="s2">/chroot_list_file=\/home\/rootsu\/vsftpd.chroot_list/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ut8 fs</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/#utf8_filesystem=.*</span>$<span class="s2">\|utf8_filesystem=.*</span>$<span class="s2">/utf8_filesystem=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">pam_service_name off</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/pam_service_name=.*</span>$<span class="s2">/#pam_service_name=vsftpd/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">rsa_cert_file=/</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/rsa_cert_file=.*</span>$<span class="s2">\|#rsa_cert_file=.*</span>$<span class="s2">/rsa_cert_file=\/etc\/ssl\/certs\/vsftpd.crt/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">This option specifies the location of the RSA certificate to use for SSL
 encrypted connections.
rsa_private_key_file=</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/rsa_private_key_file=.*</span>$<span class="s2">\|#rsa_private_key_file=.*</span>$<span class="s2">/rsa_private_key_file=\/etc\/ssl\/private\/vsftpd.key/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ssl_enable=NO</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/ssl_enable=.*</span>$<span class="s2">\|#ssl_enable=.*</span>$<span class="s2">/ssl_enable=YES/g&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">force_dot_files=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a force_dot_files=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">background=YES
pasv_port
sed -i -e &quot;$ a pasv_min_port=49000&quot; vsftpd.conf
sed -i -e &quot;$ a pasv_max_port=55000&quot; vsftpd.conf
        allow_anon_ssl=NO</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a allow_anon_ssl=NO&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">force_local_data_ssl=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a force_local_data_ssl=NO&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">force_local_logins_ssl=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a force_local_logins_ssl=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ssl_tlsv1_1=YES
sed -i -e &quot;$ a ssl_tlsv1_1=YES&quot; vsftpd.conf
        ssl_tlsv1_2=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a ssl_sslv3=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ssl_tlsv1_1=NO
ssl_tlsv1_2=YES
ssl_tlsv1=NO
ssl_sslv2=NO
ssl_sslv3=NO
        ssl_tlsv1=NO
sed -i -e &quot;$ a ssl_tlsv1=NO&quot; vsftpd.conf
        ssl_tlsv2=NO
sed -i -e &quot;$ a ssl_sslv2=NO&quot; vsftpd.conf
        ssl_sslv3=NO
sed -i -e &quot;$ a ssl_sslv3=NO&quot; vsftpd.conf
        require_ssl_reuse=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a require_ssl_reuse=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">ssl_ciphers=HIGH</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a ssl_ciphers=HIGH&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">|       |       |       Problems have been reported with EPSV. The only way to disable EPSV mode in vsftpd appears to be to disallow the EPSV and EPRT commands, so that a client will recieve a &quot;550 Permission Denied&quot; response to any EPSV command and hopefully drop back to regular PASV. Unfortunately the &quot;cmds_denied&quot; blacklisting option was only introduced in vsftpd 2.1. We therefore have to take a whitelisting approach using the &quot;cmds_allowed&quot; option. The list below basicly includes everything except the commands needed for EPSV.</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a cmds_allowed=ABOR,CWD,RMW,DELE,LIST,MDTM,MKD,NLST,PASS,PASV,PORT,PWD,QUIT,RETR,RMD,RNFR,RNTO,SITE,SIZE,STOR,TYPE,USER,CDUP,HELP,MODE,NOOP,STAT,STOU,STRU&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">USERLIST</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a userlist_enable=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">userlist_deny</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a userlist_deny=NO&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">userlist_enable</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a userlist_enable=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">userlist_file=/home/rootsu/vsftpd-virtual_user/vsftpd_user</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a userlist_file=/home/rootsu/vsftpd-virtual_user/vsftpd_user&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">user_config_dir=/</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a user_config_dir=/home/rootsu/vsftpd-virtual_user/&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">chown_uploads=YES</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a chown_uploads=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">chown_username=nobody</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a chown_username=nobody&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">Запретить /etc/vsftpd.userlist вход в список пользователей
userlist_enable=YES
userlist_deny=YES
userlist_file=/etc/vsftpd.user_list
 set it to YES to turn on TCP wappers</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a tcp_wrappers=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">set maximum allowed connections per single IP address (0 = no limits)</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a max_per_ip=10&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">Enable the userlist</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a userlist_enable=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">Allow the local users to login to the FTP (if they're in the userlist)</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a local_enable=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">Allow virtual users to use the same privileges as local users</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a virtual_use_local_privs=YES&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">Allow virtual users to use the same privileges as local users
sed -i -e &quot;$ a pam_service_name=vsftpd&quot; vsftpd.conf
 FTP port 21</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;</span>$<span class="s2"> a listen_port=21&quot;</span> vsftpd.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">PAM SHell off</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> /etc/pam.d/
<span class="linenos">2</span>sed -i -e <span class="s2">&quot;s/auth       required        pam_shells.so.*</span>$<span class="s2">\|#auth required        pam_shells.so.*</span>$<span class="s2">/#auth  required        pam_shells.so/g&quot;</span> vsftpd
</pre></div>
</div>
<div class="line-block">
<div class="line">echo -e &quot;RUnRussianSaratovn$HOSTNAME Ltd.nnadminnn&quot; | openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/certs/vsftpd.crt
 bag 500 OOPS: priv_sock_get_int.
 echo 'seccomp_sandbox=NO' &gt;&gt; /etc/vsftpd/vsftpd.conf
$ sudo openssl req -x509 -nodes -days 365 -newkey rsa:4095 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;RU\nRussia\nSaratov\n</span><span class="nv">$HOSTNAME</span><span class="s2"> Ltd.\nWSB-IOT-Embedded\nadmin\nfar1803@ya.ru\n&quot;</span> <span class="p">|</span> openssl req -x509 -nodes -days <span class="m">365</span> -newkey rsa:4096 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/certs/vsftpd.crt
<span class="linenos">2</span>
<span class="linenos">3</span>chmod <span class="m">770</span> /home/rootsu/vsftpd-virtual_user
<span class="linenos">4</span>chmod <span class="m">770</span> /home/rootsu/vsftpd.chroot_list
<span class="linenos">5</span>chmod <span class="m">750</span> -R /home/rootsu
</pre></div>
</div>
<div class="line-block">
<div class="line">List of FTP commands</div>
</div>
<blockquote>
<div><p>ABOR - Abort an active file transfer.
ACCT - Account information.
ADAT - Authentication/Security Data (RFC 2228)
ALLO - Allocate sufficient disk space to receive a file.
APPE - Append.
AUTH - Authentication/Security Mechanism (RFC 2228)
CCC  - Clear Command Channel (RFC 2228)
CDUP - Change to Parent Directory.
CONF - Confidentiality Protection Command (RFC 697)
CWD  - Change working directory.
DELE - Delete file.
ENC  - Privacy Protected Channel (RFC 2228)
EPRT - Specifies an extended address and port to which the server should connect. (RFC 2428)
EPSV - Enter extended passive mode. (RFC 2428)
FEAT - Get the feature list implemented by the server. (RFC 2389)
HELP - Returns usage documentation on a command if specified, else a general help document is returned.
LAND - Language Negotiation (RFC 2640)
LIST - Returns information of a file or directory if specified, else information of the current working directory is returned.
LPRT - Specifies a long address and port to which the server should connect. (RFC 1639)
LPSV - Enter long passive mode. (RFC 1639)
MDTM - Return the last-modified time of a specified file. (RFC 3659)
MIC  - Integrity Protected Command (RFC 2228)
MKD  - Make directory.
MLST - Lists the contents of a directory if a directory is named. (RFC 3659)
MODE - Sets the transfer mode (Stream, Block, or Compressed).
NLST - Returns a list of file names in a specified directory.
NOOP - No operation (dummy packet; used mostly on keepalives).
OPTS - Select options for a feature. (RFC 2389)
PASS - Authentication password.
PASV - Enter passive mode.
PBSZ - Protection Buffer Size (RFC 2228)
PORT - Specifies an address and port to which the server should connect.
PWD  - Print working directory. Returns the current directory of the host.
QUIT - Disconnect.
REIN - Re initializes the connection.
REST - Restart transfer from the specified point.
RETR - Retrieve (download) a remote file.
RMD  - Remove a directory.
RNFR - Rename from.
RNTO - Rename to.
SITE - Sends site specific commands to remote server.
SIZE - Return the size of a file. (RFC 3659)
SMNT - Mount file structure.
STAT - Returns the current status.
STOR - Store (upload) a file.
STOU - Store file uniquely.
STRU - Set file transfer structure.
SYST - Return system type.
TYPE - Sets the transfer mode (ASCII/Binary).
USER - Authentication username.</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>iptables -F
<span class="linenos">2</span>sudo systemctl restart vsftpd
<span class="linenos">3</span>sudo systemctl <span class="nb">enable</span> vsftpd
<span class="linenos">4</span>iptables –F
</pre></div>
</div>
<div class="line-block">
<div class="line">sudo ufw allow 20/tcp
sudo ufw allow 21/tcp</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>cp -Rf /home/admin/.ssh/ /media/admin/ssh
<span class="linenos">2</span>
<span class="linenos">3</span>cp -Rf /home/tom/.ssh/ /media/admin/ssh2
<span class="linenos">4</span>chown -Rf admin:admins /media/admin/ /home/admin/
<span class="linenos">5</span>
<span class="linenos">6</span><span class="nb">echo</span> -e <span class="s2">&quot;9_user_settings&quot;</span> &gt;&gt; steps.txt
<span class="linenos">7</span><span class="k">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">rm /install/steps.txt</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="settings-permissive-selinux">
<h3><span class="section-number">4.1.11. </span>01.11   Settings permissive SELinux<a class="headerlink" href="#settings-permissive-selinux" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>seinfo -t</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">if</span> <span class="o">[[</span> -z <span class="k">$(</span>sed -n -e <span class="s2">&quot;s/^\(10_SELinux_settings\).*/\1/p&quot;</span> steps.txt<span class="k">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>semanage fcontext -a -s system_u <span class="s2">&quot;/home/rootsu(/.*)?&quot;</span><span class="p">;</span>
<span class="linenos"> 4</span>semanage fcontext -a -t user_home_dir_t <span class="s2">&quot;/home/rootsu(/.*)?&quot;</span><span class="p">;</span>
<span class="linenos"> 5</span>chcon -Rv -u system_u -t user_home_dir_t <span class="s2">&quot;/home/rootsu/&quot;</span><span class="p">;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>semanage fcontext -a -t ftpd_etc_t <span class="s2">&quot;/home/rootsu/vsftpd-virtual_user&quot;</span><span class="p">;</span>
<span class="linenos"> 8</span>chcon -Rv -t ftpd_etc_t <span class="s2">&quot;/home/rootsu/vsftpd-virtual_user&quot;</span><span class="p">;</span>
<span class="linenos"> 9</span>semanage fcontext -a -t ftpd_etc_t <span class="s2">&quot;/home/rootsu/vsftpd.chroot_list(/.*)?&quot;</span><span class="p">;</span>
<span class="linenos">10</span>chcon -Rv -t ftpd_etc_t <span class="s2">&quot;/home/rootsu/vsftpd.chroot_list&quot;</span><span class="p">;</span>
<span class="linenos">11</span>semanage fcontext -a -t samba_etc_t <span class="s2">&quot;/home/rootsu/smbuser.conf&quot;</span><span class="p">;</span>
<span class="linenos">12</span>chcon -Rv -t samba_etc_t <span class="s2">&quot;/home/rootsu/smbuser.conf&quot;</span><span class="p">;</span>
<span class="linenos">13</span>semanage fcontext -a -t samba_etc_t <span class="s2">&quot;/home/rootsu/.smbusers&quot;</span><span class="p">;</span>
<span class="linenos">14</span>chcon -Rv -t samba_etc_t <span class="s2">&quot;/home/rootsu/.smbusers&quot;</span><span class="p">;</span>
<span class="linenos">15</span>semanage fcontext -a -u system_u <span class="s2">&quot;/home/&quot;</span><span class="p">;</span>
<span class="linenos">16</span>chcon -Rv -u system_u <span class="s2">&quot;/home/&quot;</span><span class="p">;</span>
<span class="linenos">17</span>
<span class="linenos">18</span>chcon -Rv -t public_content_rw_t <span class="s2">&quot;/media/admin&quot;</span><span class="p">;</span>
<span class="linenos">19</span>semanage fcontext -a -t public_content_rw_t <span class="s2">&quot;/media/admin(/.*)?&quot;</span><span class="p">;</span>
<span class="linenos">20</span>
<span class="linenos">21</span>setfacl -m u:admin:rwx,u:admin_share:rwx -R <span class="s2">&quot;/media/admin&quot;</span><span class="p">;</span>
<span class="linenos">22</span>setfacl -m g:admins:rw -R <span class="s2">&quot;/media/admin&quot;</span><span class="p">;</span>
<span class="linenos">23</span>chmod go-rwx -R <span class="s2">&quot;/media/admin&quot;</span><span class="p">;</span>
<span class="linenos">24</span>
<span class="linenos">25</span>semanage fcontext -a -t public_content_rw_t <span class="s2">&quot;/opt(/.*)?&quot;</span>
<span class="linenos">26</span>chcon -Rv -t public_content_rw_t <span class="s2">&quot;/opt/&quot;</span><span class="p">;</span>
<span class="linenos">27</span>chmod o-rwx -R <span class="s2">&quot;/opt/SAMBA_SHARE/&quot;</span><span class="p">;</span>
<span class="linenos">28</span>setfacl -m g:technics:rwx -R <span class="s2">&quot;/opt/SAMBA_SHARE/&quot;</span><span class="p">;</span>
<span class="linenos">29</span>setfacl -m u:pub_share:rwx,u:admin_share:rwx -R <span class="s2">&quot;/opt/SAMBA_SHARE/&quot;</span><span class="p">;</span>
<span class="linenos">30</span>
<span class="linenos">31</span>setsebool -P ssh_sysadm_login on
</pre></div>
</div>
<div class="line-block">
<div class="line">setsebool -P allow_use_cifs on
setsebool -P allow_use_nfs on</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>setsebool -P httpd_use_cifs on
<span class="linenos"> 2</span>setsebool -P allow_ftpd_use_nfs <span class="m">1</span>
<span class="linenos"> 3</span>setsebool -P allow_ftpd_use_cifs <span class="m">1</span>
<span class="linenos"> 4</span>setsebool -P ftpd_connect_db <span class="m">1</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>setsebool -P ftp_home_dir on
<span class="linenos"> 7</span>setsebool -P allow_ftpd_full_access on
<span class="linenos"> 8</span>setsebool -P ftpd_use_passive_mode on
<span class="linenos"> 9</span>
<span class="linenos">10</span>semanage port -a -t ssh_port_t -p tcp <span class="m">4103</span>
<span class="linenos">11</span>semanage port -a -t smbd_port_t -p tcp <span class="m">445</span>
<span class="linenos">12</span>semanage port -a -t ftp_port_t -p tcp <span class="m">21</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="nb">cd</span> ~
<span class="linenos">15</span>semodule -i mountlocv1v2.pp
<span class="linenos">16</span>
<span class="linenos">17</span><span class="nv">COUNT</span><span class="o">=</span><span class="m">1</span><span class="p">;</span>
<span class="linenos">18</span>ip addr <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*1\:\s\(.*\)\:\s&lt;.*/\1/p&quot;</span>
<span class="linenos">19</span><span class="k">while</span> <span class="o">[[</span> -n <span class="k">$(</span> ip addr <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*</span><span class="nv">$COUNT</span><span class="s2">\:\s\(.*\)\:\s&lt;.*/\1/p&quot;</span><span class="k">)</span> <span class="o">]]</span>
<span class="linenos">20</span><span class="k">do</span>
<span class="linenos">21</span>semanage interface -a -t netif_t -r s0-s0:c0.c1023 <span class="k">$(</span> ip addr <span class="p">|</span> sed -n -e <span class="s2">&quot;s/.*</span><span class="nv">$COUNT</span><span class="s2">\:\s\(.*\)\:\s&lt;.*/\1/p&quot;</span><span class="k">)</span>
<span class="linenos">22</span><span class="o">((</span>COUNT++<span class="o">))</span><span class="p">;</span>
<span class="linenos">23</span><span class="k">done</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">semanage permissive -a sshd_t</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>semanage permissive -a boot_t
</pre></div>
</div>
<div class="line-block">
<div class="line">setsebool -P allow_execmem 1
setsebool -P allow_execheap 1
setsebool -P allow_user_mysql_connect 1</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>setsebool -P cron_can_relabel <span class="m">1</span>
<span class="linenos">2</span>setsebool -P fcron_crond <span class="m">1</span>
<span class="linenos">3</span>setsebool -P cron_userdomain_transition <span class="m">1</span>
<span class="linenos">4</span>setsebool -P cron_manage_all_user_content <span class="m">1</span>
<span class="linenos">5</span>setsebool -P cron_read_all_user_content <span class="m">1</span>
<span class="linenos">6</span>setsebool -P cron_read_generic_user_content <span class="m">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">setsebool -P samba_run_unconfined 1</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>setsebool -P allow_mount_anyfile <span class="m">1</span>
<span class="linenos">2</span>setsebool -P webadm_manage_user_files <span class="m">1</span>
<span class="linenos">3</span>setsebool -P webadm_read_user_files <span class="m">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">setsebool -P use_nfs_home_dirs 1</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>setsebool -P samba_export_all_ro <span class="m">1</span>
<span class="linenos">2</span>setsebool -P samba_export_all_rw <span class="m">1</span>
<span class="linenos">3</span>setsebool -P dhcpc_manage_samba <span class="m">1</span>
<span class="linenos">4</span>setsebool -P samba_create_home_dirs <span class="m">1</span>
<span class="linenos">5</span>setsebool -P samba_enable_home_dirs <span class="m">1</span>
<span class="linenos">6</span>setsebool -P samba_share_fusefs <span class="m">1</span>
<span class="linenos">7</span>setsebool -P samba_share_nfs <span class="m">1</span>
<span class="linenos">8</span>setsebool -P use_samba_home_dirs <span class="m">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">setsebool -P use_samba_nfs_dirs 1</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>setsebool -P virt_use_samba <span class="m">1</span>
<span class="linenos">2</span>setsebool -P virt_use_nfs <span class="m">1</span>
<span class="linenos">3</span>setsebool -P samba_portmapper <span class="m">1</span>
<span class="linenos">4</span>setsebool -P systemd_tmpfiles_manage_all <span class="m">1</span>
<span class="linenos">5</span>setsebool -P cron_manage_generic_user_content <span class="m">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">setsebool -P nscd_use_shm 1</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>setsebool -P use_nfs_home_dirs <span class="m">1</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>setsebool -P sudo_all_tcp_connect_http_port <span class="m">1</span>
<span class="linenos"> 4</span>setsebool -P git_cgi_enable_homedirs <span class="m">1</span>
<span class="linenos"> 5</span>setsebool -P git_cgi_use_cifs <span class="m">1</span>
<span class="linenos"> 6</span>setsebool -P git_cgi_use_nfs <span class="m">1</span>
<span class="linenos"> 7</span>setsebool -P git_session_bind_all_unreserved_ports <span class="m">1</span>
<span class="linenos"> 8</span>setsebool -P git_session_send_syslog_msg <span class="m">1</span>
<span class="linenos"> 9</span>setsebool -P git_session_users <span class="m">1</span>
<span class="linenos">10</span>setsebool -P git_system_enable_homedirs <span class="m">1</span>
<span class="linenos">11</span>setsebool -P git_system_use_cifs <span class="m">1</span>
<span class="linenos">12</span>setsebool -P git_system_use_nfs <span class="m">1</span>
<span class="linenos">13</span>
<span class="linenos">14</span>systemctl <span class="nb">enable</span> mcstrans
<span class="linenos">15</span>systemctl start mcstrans
<span class="linenos">16</span>
<span class="linenos">17</span>systemctl reenable fstrim.timer
<span class="linenos">18</span>systemctl reenable fstrim.timer
<span class="linenos">19</span>systemctl start fstrim.service
<span class="linenos">20</span>systemctl start fstrim.timer
</pre></div>
</div>
<div class="line-block">
<div class="line">setenforce 0</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> /etc/selinux
</pre></div>
</div>
<div class="line-block">
<div class="line">systemctl disable auditd</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sed -i -e <span class="s2">&quot;s/SELINUX=permissive\|SELINUX=default/SELINUX=enforcing/g&quot;</span> config
</pre></div>
</div>
<div class="line-block">
<div class="line">ROLE=sysadm_r</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>sed -i -e <span class="s2">&quot;s/%sudo.*</span>$<span class="s2">/%sudo     ALL=(root) TYPE=sysadm_sudo_t NOPASSWD:ALL/g&quot;</span> /etc/sudoers
<span class="linenos"> 2</span>sed -i -e <span class="s2">&quot;s/%admins.*</span>$<span class="s2">/%admins ALL=(root) ROLE=sysadm_r NOPASSWD:ALL/g&quot;</span> /etc/sudoers
<span class="linenos"> 3</span>sed -i -e <span class="s2">&quot;s/admin.*</span>$<span class="s2">/admin     ALL=(root) ROLE=sysadm_r NOPASSWD:ALL/g&quot;</span> /etc/sudoers
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>sed -i -e <span class="s1">&#39;1 a session  required        pam_selinux.so  close&#39;</span> /etc/pam.d/sshd
<span class="linenos"> 6</span>sed -i -e <span class="s1">&#39;$a session   required        pam_selinux.so  multiple open&#39;</span> /etc/pam.d/sshd &gt;&gt; /etc/pam.d/sshd
<span class="linenos"> 7</span>sed -i -e <span class="s1">&#39;$a session   required        pam_access.so&#39;</span> /etc/pam.d/sshd &gt;&gt; /etc/pam.d/sshd
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>sed -i -e <span class="s1">&#39;$a -a exit,always -S open -F auid&gt;=0&#39;</span> /etc/audit/audit.rules
<span class="linenos">10</span>
<span class="linenos">11</span>chmod o-x <span class="s2">&quot;/etc/systemd/system.conf&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">rm /install/pii2.sh /etc/init.d/
update-rc.d -f pii2.sh remove
chmod o-rw -R &quot;/etc/&quot;;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>chmod o-rwx -R <span class="s2">&quot;/boot/&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">chmod o-rwx &quot;/var/&quot;;
chmod o-rwx &quot;/sys/&quot;;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>chmod o-rwx -R <span class="s2">&quot;/srv/&quot;</span><span class="p">;</span>
<span class="linenos">2</span>chmod o-rwx -R <span class="s2">&quot;/mnt/&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">chmod o-rwx &quot;/proc/&quot;;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>semanage fcontext -a -t tmp_t <span class="s2">&quot;/tmp(/.*)?&quot;</span>
<span class="linenos">2</span>chcon -t tmp_t -R <span class="s2">&quot;/tmp&quot;</span>
<span class="linenos">3</span>chmod o-rwx -R <span class="s2">&quot;/tmp/&quot;</span><span class="p">;</span>
<span class="linenos">4</span>chmod o-rwx <span class="s2">&quot;/media/&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">chmod o-rw &quot;/dev/&quot;;
chmod o+r &quot;/etc/profile&quot;;
chmod o+rx -R &quot;/etc/profile.d/&quot;;
chmod o+rx &quot;/etc/bash.bashrc&quot;;
chmod o+r &quot;/etc/nanorc&quot;;
chmod o+r &quot;/etc/passwd&quot;;
chmod o+r &quot;/etc/passwd-&quot;;
chmod o+r &quot;/etc/group&quot;;
chmod o+r &quot;/etc/hostname&quot;;
chmod o+rx &quot;/etc/console-setup&quot;;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>semanage fcontext -a -t system_cron_spool_t <span class="s2">&quot;/var/spool/cron(/.*)?&quot;</span>
<span class="linenos">2</span>chcon -t system_cron_spool_t -Rv /var/spool/cron/
<span class="linenos">3</span>
<span class="linenos">4</span>chmod o-r -R <span class="s2">&quot;/home/&quot;</span><span class="p">;</span>
<span class="linenos">5</span>chmod o-x -R <span class="s2">&quot;/home/rootsu&quot;</span> <span class="s2">&quot;/home/admin/&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">chmod o-r &quot;/usr/bin/&quot;;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> <span class="s2">&quot;deb https:\\\download.webmin.com\download\repository sarge contrib&quot;</span> &gt;&gt; /etc/apt/sources.list
</pre></div>
</div>
<div class="line-block">
<div class="line">apt-get update
dpkg --configure -a
apt-get dist-upgrade</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;\y\n&quot;</span> <span class="p">|</span> apt-get -f install
</pre></div>
</div>
<div class="line-block">
<div class="line">echo -e &quot;yn&quot; | apt-get remove nvidia-*</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get autoremove
</pre></div>
</div>
<div class="line-block">
<div class="line">nvidia-uninstall</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">cd</span> ~
</pre></div>
</div>
<div class="line-block">
<div class="line">grep AVC /var/log/audit/audit.log | audit2allow -m loaderlocalv4 &gt; loaderlocalv4.te
grep AVC altlog.log | audit2allow -m loaderlocalv4 &gt; loaderlocalv4.te
checkmodule -M -m -o loaderlocalv1.mod loaderlocalv1.te
semodule_package -o loaderlocalv1.pp -m loaderlocalv1.mod</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>semodule -i loaderlocalv1.pp
<span class="linenos">2</span>semodule -i loaderlocalv2.pp
<span class="linenos">3</span>semodule -i loaderlocalv3.pp
<span class="linenos">4</span>semodule -i loaderlocalv4.pp
</pre></div>
</div>
<div class="line-block">
<div class="line">sudo apt-get install
sudo apt-get automount</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>semodule -i sudotev1.pp
<span class="linenos"> 2</span>semodule -i sudotev2.pp
<span class="linenos"> 3</span>semodule -i sudotev3.pp
<span class="linenos"> 4</span>semodule -i sudotev4.pp
<span class="linenos"> 5</span>semodule -i sudotev5.pp
<span class="linenos"> 6</span>semodule -i sudotevb1.pp
<span class="linenos"> 7</span>semodule -i sudotevb2.pp
<span class="linenos"> 8</span>semodule -i sudotev70522v21.pp
<span class="linenos"> 9</span>semodule -i sudotevcrondv1.pp
<span class="linenos">10</span>semodule -i sphinxtev1.pp
</pre></div>
</div>
<div class="line-block">
<div class="line">touch log.log
journalctl -xe &gt;&gt; log.log
grep AVC log.log | audit2allow -m sudotev1 &gt; sudotev1.te
checkmodule -M -m -o sudotev1.mod sudotev1.te
semodule_package -o sudotev1.pp -m sudotev1.mod</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">semodule -i sudotev1.pp</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>update-initramfs -k all -u
<span class="linenos"> 2</span>update-grub
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install apt-transport-https
<span class="linenos"> 5</span><span class="nb">echo</span> -e <span class="s2">&quot;y\n&quot;</span> <span class="p">|</span> apt-get install perl libnet-ssleay-perl openssl libauthen-pam-perl libpam-runtime libio-pty-perl apt-show-versions python unzip
<span class="linenos"> 6</span><span class="nb">cd</span> /root
<span class="linenos"> 7</span>wget https://download.webmin.com/jcameron-key.asc
<span class="linenos"> 8</span>cat jcameron-key.asc <span class="p">|</span> gpg --dearmor &gt;/usr/share/keyrings/jcameron-key.gpg
<span class="linenos"> 9</span><span class="nb">cd</span> /install/
<span class="linenos">10</span>wget http://prdownloads.sourceforge.net/webadmin/webmin_1.991_all.deb
<span class="linenos">11</span>dpkg --install webmin_1.991_all.deb
<span class="linenos">12</span>mkdir /var/webmin/.webmin
<span class="linenos">13</span>chmod <span class="m">755</span> /var/webmin/.webmin
<span class="linenos">14</span>semanage fcontext -a -t tmp_t <span class="s2">&quot;/var/webmin/.webmin&quot;</span><span class="p">;</span>
<span class="linenos">15</span>chcon -Rv -t tmp_t <span class="s2">&quot;/var/webmin/.webmin&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">echo -e &quot;yn&quot; | apt-get install apt-transport-https
echo -e &quot;yn&quot; | apt-get update
echo -e &quot;yn&quot; | apt-get install webmin</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>semanage port -a -t http_port_t -p tcp <span class="m">10000</span>
<span class="linenos"> 2</span>semanage port -a -t http_port_t -p tcp <span class="m">20000</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>systemctl <span class="nb">enable</span> webmin
<span class="linenos"> 5</span>systemctl start webmin
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>semanage permissive -a boot_t
<span class="linenos"> 8</span>semanage permissive -a crond_t
<span class="linenos"> 9</span>semanage permissive -a crontab_t
<span class="linenos">10</span>semanage permissive -a system_crontab_t
<span class="linenos">11</span>semanage module -d permissive_boot_t
</pre></div>
</div>
<div class="line-block">
<div class="line">semanage module -r permissive_boot_t
semanage user -m -R &quot;system_r sysadm_r staff_r&quot; -r &quot;s0-s0:c0.c1023&quot; sysadm_u
semanage user -m -R &quot;system_r&quot; -r &quot;s0-s0:c0.c1023&quot; system_u</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>semanage login -a -s sysadm_u -r <span class="s2">&quot;s0-s0:c0.c1023&quot;</span> admin
<span class="linenos">2</span>semanage login -a -s root -r <span class="s2">&quot;s0-s0:c0.c1023&quot;</span> admin_tech
<span class="linenos">3</span>semanage login -a -s sysadm_u -r <span class="s2">&quot;s0-s0:c0.c1023&quot;</span> %admins
</pre></div>
</div>
<div class="line-block">
<div class="line">semanage login -m -s sysadm_u -r &quot;s0-s0:c0.c1023&quot; root
semanage login -a -s sysadm_u -r &quot;s0-s0:c0.c1023&quot; %root</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>semanage login -a -s sysadm_u -r <span class="s2">&quot;s0-s0:c0.c1023&quot;</span> %sudo
<span class="linenos">2</span>semanage login -a -s user_u tom
</pre></div>
</div>
<div class="line-block">
<div class="line">sudo chmod o-rwx -R &quot;/etc/&quot;;
sudo chmod o-rwx -R &quot;/boot/&quot;;
sudo chmod o-rwx -R &quot;/var/&quot;;
sudo chmod o+rwx &quot;/sys/&quot;;
sudo chmod o+rwx -R &quot;/srv/&quot;;
sudo chmod o+rwx -R &quot;/mnt/&quot;;
sudo chmod o+rwx &quot;/proc/&quot;;
sudo chmod o+rwx -R &quot;/tmp/&quot;;
sudo chmod o+rwx &quot;/media/&quot;;
sudo chmod o+rwx &quot;/dev/&quot;;
chmod o+rx &quot;/etc/profile&quot;;
chmod o+rx &quot;/etc/bash.bashrc&quot;;
chmod o+rx &quot;/etc/nanorc&quot;;
chmod o+rx &quot;/etc/passwd&quot;;</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Display manager: gdm3 sddm
GDM KDM LightDM LXDM МДМ SLIM XDM</div>
</div>
<blockquote>
<div><p>sudo systemctl disable mdm.service
sudo systemctl enable sddm.service</p>
<p>kde-full</p>
<p>sudo tasksel install kde-desktop</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>setenforce <span class="m">1</span>
<span class="linenos">2</span><span class="nb">echo</span> -e <span class="s2">&quot;10_SELinux_settings&quot;</span> &gt;&gt; steps.txt
<span class="linenos">3</span><span class="k">fi</span>
<span class="linenos">4</span><span class="nb">echo</span> <span class="s2">&quot;Press ESC key to quit&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">read a single character</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">while</span> <span class="nb">read</span> -r -n1 key
<span class="linenos">2</span><span class="k">do</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">if input == ESC key</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$key</span> <span class="o">==</span> <span class="s1">$&#39;\e&#39;</span> <span class="o">]]</span><span class="p">;</span>
<span class="linenos">2</span><span class="k">then</span>
<span class="linenos">3</span>break<span class="p">;</span>
<span class="linenos">4</span><span class="k">fi</span>
<span class="linenos">5</span><span class="k">done</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">set +x
ls -la</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">exit</span> <span class="m">0</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cut_discr_preseed.html" class="btn btn-neutral float-left" title="3. Preseed Cut Discr" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="full_discr.html" class="btn btn-neutral float-right" title="5. Полное описание конфигурации сервера" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, BiLymo iOT corp.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>